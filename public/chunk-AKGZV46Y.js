import{u as ml}from"./chunk-EH4JQX56.js";import{Y as nl,ba as rl}from"./chunk-SQWIEUAN.js";import{D as fo,L as _t,M as ul,N as jt,O as cl,S as ll,T as hl,U as dl,W as fl,Z as mo,g as il,i as sl,j as yr,r as ho,s as ol,t as al}from"./chunk-WCZP2BTM.js";import{e as lo,f as V}from"./chunk-CQCHLVVT.js";var qg=(()=>{let t=class t{constructor(n){this._snackBar=n}mostrarError(n){this._snackBar.open(n,"Cerrar",{duration:3e3,verticalPosition:"bottom"})}};t.\u0275fac=function(i){return new(i||t)(rl(ml))},t.\u0275prov=nl({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var gl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pl={};var pe,go;(function(){var r;function t(v,p){function _(){}_.prototype=p.prototype,v.D=p.prototype,v.prototype=new _,v.prototype.constructor=v,v.C=function(I,T,A){for(var y=Array(arguments.length-2),te=2;te<arguments.length;te++)y[te-2]=arguments[te];return p.prototype[T].apply(I,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,_){_||(_=0);var I=Array(16);if(typeof p=="string")for(var T=0;16>T;++T)I[T]=p.charCodeAt(_++)|p.charCodeAt(_++)<<8|p.charCodeAt(_++)<<16|p.charCodeAt(_++)<<24;else for(T=0;16>T;++T)I[T]=p[_++]|p[_++]<<8|p[_++]<<16|p[_++]<<24;p=v.g[0],_=v.g[1],T=v.g[2];var A=v.g[3],y=p+(A^_&(T^A))+I[0]+3614090360&4294967295;p=_+(y<<7&4294967295|y>>>25),y=A+(T^p&(_^T))+I[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(_^A&(p^_))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=_+(p^T&(A^p))+I[3]+3250441966&4294967295,_=T+(y<<22&4294967295|y>>>10),y=p+(A^_&(T^A))+I[4]+4118548399&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(T^p&(_^T))+I[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(_^A&(p^_))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=_+(p^T&(A^p))+I[7]+4249261313&4294967295,_=T+(y<<22&4294967295|y>>>10),y=p+(A^_&(T^A))+I[8]+1770035416&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(T^p&(_^T))+I[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(_^A&(p^_))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=_+(p^T&(A^p))+I[11]+2304563134&4294967295,_=T+(y<<22&4294967295|y>>>10),y=p+(A^_&(T^A))+I[12]+1804603682&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(T^p&(_^T))+I[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(_^A&(p^_))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=_+(p^T&(A^p))+I[15]+1236535329&4294967295,_=T+(y<<22&4294967295|y>>>10),y=p+(T^A&(_^T))+I[1]+4129170786&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^T&(p^_))+I[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^_&(A^p))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(T^A))+I[0]+3921069994&4294967295,_=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(_^T))+I[5]+3593408605&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^T&(p^_))+I[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^_&(A^p))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(T^A))+I[4]+3889429448&4294967295,_=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(_^T))+I[9]+568446438&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^T&(p^_))+I[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^_&(A^p))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(T^A))+I[8]+1163531501&4294967295,_=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(_^T))+I[13]+2850285829&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^T&(p^_))+I[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^_&(A^p))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(T^A))+I[12]+2368359562&4294967295,_=T+(y<<20&4294967295|y>>>12),y=p+(_^T^A)+I[5]+4294588738&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^T)+I[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^_)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=_+(T^A^p)+I[14]+4259657740&4294967295,_=T+(y<<23&4294967295|y>>>9),y=p+(_^T^A)+I[1]+2763975236&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^T)+I[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^_)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=_+(T^A^p)+I[10]+3200236656&4294967295,_=T+(y<<23&4294967295|y>>>9),y=p+(_^T^A)+I[13]+681279174&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^T)+I[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^_)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=_+(T^A^p)+I[6]+76029189&4294967295,_=T+(y<<23&4294967295|y>>>9),y=p+(_^T^A)+I[9]+3654602809&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^T)+I[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^_)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=_+(T^A^p)+I[2]+3299628645&4294967295,_=T+(y<<23&4294967295|y>>>9),y=p+(T^(_|~A))+I[0]+4096336452&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~T))+I[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~_))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=_+(A^(T|~p))+I[5]+4237533241&4294967295,_=T+(y<<21&4294967295|y>>>11),y=p+(T^(_|~A))+I[12]+1700485571&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~T))+I[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~_))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=_+(A^(T|~p))+I[1]+2240044497&4294967295,_=T+(y<<21&4294967295|y>>>11),y=p+(T^(_|~A))+I[8]+1873313359&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~T))+I[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~_))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=_+(A^(T|~p))+I[13]+1309151649&4294967295,_=T+(y<<21&4294967295|y>>>11),y=p+(T^(_|~A))+I[4]+4149444226&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~T))+I[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~_))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=_+(A^(T|~p))+I[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+T&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var _=p-this.blockSize,I=this.B,T=this.h,A=0;A<p;){if(T==0)for(;A<=_;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(I[T++]=v.charCodeAt(A++),T==this.blockSize){i(this,I),T=0;break}}else for(;A<p;)if(I[T++]=v[A++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var _=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=_&255,_/=256;for(this.u(v),v=Array(16),p=_=0;4>p;++p)for(var I=0;32>I;I+=8)v[_++]=this.g[p]>>>I&255;return v};function s(v,p){var _=u;return Object.prototype.hasOwnProperty.call(_,v)?_[v]:_[v]=p(v)}function a(v,p){this.h=p;for(var _=[],I=!0,T=v.length-1;0<=T;T--){var A=v[T]|0;I&&A==p||(_[T]=A,I=!1)}this.g=_}var u={};function l(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return D(d(-v));for(var p=[],_=1,I=0;v>=_;I++)p[I]=v/_|0,_*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return D(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(p,8)),I=g,T=0;T<v.length;T+=8){var A=Math.min(8,v.length-T),y=parseInt(v.substring(T,T+A),p);8>A?(A=d(Math.pow(p,A)),I=I.j(A).add(d(y))):(I=I.j(_),I=I.add(d(y)))}return I}var g=l(0),w=l(1),b=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-D(this).m();for(var v=0,p=1,_=0;_<this.g.length;_++){var I=this.i(_);v+=(0<=I?I:4294967296+I)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(N(this))return"0";if(k(this))return"-"+D(this).toString(v);for(var p=d(Math.pow(v,6)),_=this,I="";;){var T=W(_,p).g;_=G(_,T.j(p));var A=((0<_.g.length?_.g[0]:_.h)>>>0).toString(v);if(_=T,N(_))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function N(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function k(v){return v.h==-1}r.l=function(v){return v=G(this,v),k(v)?-1:N(v)?0:1};function D(v){for(var p=v.g.length,_=[],I=0;I<p;I++)_[I]=~v.g[I];return new a(_,~v.h).add(w)}r.abs=function(){return k(this)?D(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],I=0,T=0;T<=p;T++){var A=I+(this.i(T)&65535)+(v.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(v.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,_[T]=y<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(v,p){return v.add(D(p))}r.j=function(v){if(N(this)||N(v))return g;if(k(this))return k(v)?D(this).j(D(v)):D(D(this).j(v));if(k(v))return D(this.j(D(v)));if(0>this.l(b)&&0>v.l(b))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,_=[],I=0;I<2*p;I++)_[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<v.g.length;T++){var A=this.i(I)>>>16,y=this.i(I)&65535,te=v.i(T)>>>16,Yn=v.i(T)&65535;_[2*I+2*T]+=y*Yn,z(_,2*I+2*T),_[2*I+2*T+1]+=A*Yn,z(_,2*I+2*T+1),_[2*I+2*T+1]+=y*te,z(_,2*I+2*T+1),_[2*I+2*T+2]+=A*te,z(_,2*I+2*T+2)}for(I=0;I<p;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=p;I<2*p;I++)_[I]=0;return new a(_,0)};function z(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function B(v,p){this.g=v,this.h=p}function W(v,p){if(N(p))throw Error("division by zero");if(N(v))return new B(g,g);if(k(v))return p=W(D(v),p),new B(D(p.g),D(p.h));if(k(p))return p=W(v,D(p)),new B(D(p.g),p.h);if(30<v.g.length){if(k(v)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var _=w,I=p;0>=I.l(v);)_=Z(_),I=Z(I);var T=Q(_,1),A=Q(I,1);for(I=Q(I,2),_=Q(_,2);!N(I);){var y=A.add(I);0>=y.l(v)&&(T=T.add(_),A=y),I=Q(I,1),_=Q(_,1)}return p=G(v,T.j(p)),new B(T,p)}for(T=g;0<=v.l(p);){for(_=Math.max(1,Math.floor(v.m()/p.m())),I=Math.ceil(Math.log(_)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(_),y=A.j(p);k(y)||0<y.l(v);)_-=I,A=d(_),y=A.j(p);N(A)&&(A=w),T=T.add(A),v=G(v,y)}return new B(T,v)}r.A=function(v){return W(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],I=0;I<p;I++)_[I]=this.i(I)&v.i(I);return new a(_,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],I=0;I<p;I++)_[I]=this.i(I)|v.i(I);return new a(_,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],I=0;I<p;I++)_[I]=this.i(I)^v.i(I);return new a(_,this.h^v.h)};function Z(v){for(var p=v.g.length+1,_=[],I=0;I<p;I++)_[I]=v.i(I)<<1|v.i(I-1)>>>31;return new a(_,v.h)}function Q(v,p){var _=p>>5;p%=32;for(var I=v.g.length-_,T=[],A=0;A<I;A++)T[A]=0<p?v.i(A+_)>>>p|v.i(A+_+1)<<32-p:v.i(A+_);return new a(T,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,go=pl.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,pe=pl.Integer=a}).apply(typeof gl<"u"?gl:typeof self<"u"?self:typeof window<"u"?window:{});var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},re={};var po,yo,fn,_o,_r,Ei,wo,vo,Io;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ti=="object"&&Ti];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var R=h++;return{value:c(R,o[R]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function w(o,c,h){return w=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,w.apply(null,arguments)}function b(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function N(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,R){for(var M=Array(arguments.length-2),et=2;et<arguments.length;et++)M[et-2]=arguments[et];return c.prototype[E].apply(m,M)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function D(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let E=o.length||0,R=m.length||0;o.length=E+R;for(let M=0;M<R;M++)o[E+M]=m[M]}else o.push(m)}}class G{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function z(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function W(o){return W[" "](o),o}W[" "]=function(){};var Z=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function Q(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function v(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,c){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let R=0;R<_.length;R++)h=_[R],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=qs;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class te{constructor(){this.h=this.g=null}add(c,h){let m=Yn.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var Yn=new G(()=>new sf,o=>o.reset());class sf{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Zn,tr=!1,qs=new te,ec=()=>{let o=u.Promise.resolve(void 0);Zn=()=>{o.then(of)}};var of=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=Yn;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}tr=!1};function de(){this.s=this.s,this.C=this.C}de.prototype.s=!1,de.prototype.ma=function(){this.s||(this.s=!0,this.N())},de.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function St(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var af=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function er(o,c){if(St.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(Z){t:{try{W(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:uf[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&er.aa.h.call(this)}}N(er,St);var uf={2:"touch",3:"pen",4:"mouse"};er.prototype.h=function(){er.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var nr="closure_listenable_"+(1e6*Math.random()|0),cf=0;function lf(o,c,h,m,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=E,this.key=++cf,this.da=this.fa=!1}function si(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function oi(o){this.src=o,this.g={},this.h=0}oi.prototype.add=function(o,c,h,m,E){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var M=Bs(o,c,m,E);return-1<M?(c=o[M],h||(c.fa=!1)):(c=new lf(c,this.src,R,!!m,E),c.fa=h,o.push(c)),c};function Us(o,c){var h=c.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,c,void 0),R;(R=0<=E)&&Array.prototype.splice.call(m,E,1),R&&(si(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Bs(o,c,h,m){for(var E=0;E<o.length;++E){var R=o[E];if(!R.da&&R.listener==c&&R.capture==!!h&&R.ha==m)return E}return-1}var Gs="closure_lm_"+(1e6*Math.random()|0),zs={};function nc(o,c,h,m,E){if(m&&m.once)return ic(o,c,h,m,E);if(Array.isArray(c)){for(var R=0;R<c.length;R++)nc(o,c[R],h,m,E);return null}return h=$s(h),o&&o[nr]?o.K(c,h,d(m)?!!m.capture:!!m,E):rc(o,c,h,!1,m,E)}function rc(o,c,h,m,E,R){if(!c)throw Error("Invalid event type");var M=d(E)?!!E.capture:!!E,et=Ks(o);if(et||(o[Gs]=et=new oi(o)),h=et.add(c,h,m,M,R),h.proxy)return h;if(m=hf(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)af||(E=M),E===void 0&&(E=!1),o.addEventListener(c.toString(),m,E);else if(o.attachEvent)o.attachEvent(oc(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function hf(){function o(h){return c.call(o.src,o.listener,h)}let c=df;return o}function ic(o,c,h,m,E){if(Array.isArray(c)){for(var R=0;R<c.length;R++)ic(o,c[R],h,m,E);return null}return h=$s(h),o&&o[nr]?o.L(c,h,d(m)?!!m.capture:!!m,E):rc(o,c,h,!0,m,E)}function sc(o,c,h,m,E){if(Array.isArray(c))for(var R=0;R<c.length;R++)sc(o,c[R],h,m,E);else m=d(m)?!!m.capture:!!m,h=$s(h),o&&o[nr]?(o=o.i,c=String(c).toString(),c in o.g&&(R=o.g[c],h=Bs(R,h,m,E),-1<h&&(si(R[h]),Array.prototype.splice.call(R,h,1),R.length==0&&(delete o.g[c],o.h--)))):o&&(o=Ks(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Bs(c,h,m,E)),(h=-1<o?c[o]:null)&&js(h))}function js(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[nr])Us(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(oc(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=Ks(c))?(Us(h,o),h.h==0&&(h.src=null,c[Gs]=null)):si(o)}}}function oc(o){return o in zs?zs[o]:zs[o]="on"+o}function df(o,c){if(o.da)o=!0;else{c=new er(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&js(o),o=h.call(m,c)}return o}function Ks(o){return o=o[Gs],o instanceof oi?o:null}var Qs="__closure_events_fn_"+(1e9*Math.random()>>>0);function $s(o){return typeof o=="function"?o:(o[Qs]||(o[Qs]=function(c){return o.handleEvent(c)}),o[Qs])}function bt(){de.call(this),this.i=new oi(this),this.M=this,this.F=null}N(bt,de),bt.prototype[nr]=!0,bt.prototype.removeEventListener=function(o,c,h,m){sc(this,o,c,h,m)};function xt(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new St(c,o);else if(c instanceof St)c.target=c.target||o;else{var E=c;c=new St(m,o),I(c,E)}if(E=!0,h)for(var R=h.length-1;0<=R;R--){var M=c.g=h[R];E=ai(M,m,!0,c)&&E}if(M=c.g=o,E=ai(M,m,!0,c)&&E,E=ai(M,m,!1,c)&&E,h)for(R=0;R<h.length;R++)M=c.g=h[R],E=ai(M,m,!1,c)&&E}bt.prototype.N=function(){if(bt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)si(h[m]);delete o.g[c],o.h--}}this.F=null},bt.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},bt.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function ai(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,R=0;R<c.length;++R){var M=c[R];if(M&&!M.da&&M.capture==h){var et=M.listener,Tt=M.ha||M.src;M.fa&&Us(o.i,M),E=et.call(Tt,m)!==!1&&E}}return E&&!m.defaultPrevented}function ac(o,c,h){if(typeof o=="function")h&&(o=w(o,h));else if(o&&typeof o.handleEvent=="function")o=w(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function uc(o){o.g=ac(()=>{o.g=null,o.i&&(o.i=!1,uc(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class ff extends de{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:uc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rr(o){de.call(this),this.h=o,this.g={}}N(rr,de);var cc=[];function lc(o){Q(o.g,function(c,h){this.g.hasOwnProperty(h)&&js(c)},o),o.g={}}rr.prototype.N=function(){rr.aa.N.call(this),lc(this)},rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ws=u.JSON.stringify,mf=u.JSON.parse,gf=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Hs(){}Hs.prototype.h=null;function hc(o){return o.h||(o.h=o.i())}function dc(){}var ir={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Js(){St.call(this,"d")}N(Js,St);function Xs(){St.call(this,"c")}N(Xs,St);var Oe={},fc=null;function ui(){return fc=fc||new bt}Oe.La="serverreachability";function mc(o){St.call(this,Oe.La,o)}N(mc,St);function sr(o){let c=ui();xt(c,new mc(c))}Oe.STAT_EVENT="statevent";function gc(o,c){St.call(this,Oe.STAT_EVENT,o),this.stat=c}N(gc,St);function Dt(o){let c=ui();xt(c,new gc(c,o))}Oe.Ma="timingevent";function pc(o,c){St.call(this,Oe.Ma,o),this.size=c}N(pc,St);function or(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function ar(){this.g=!0}ar.prototype.xa=function(){this.g=!1};function pf(o,c,h,m,E,R){o.info(function(){if(o.g)if(R)for(var M="",et=R.split("&"),Tt=0;Tt<et.length;Tt++){var X=et[Tt].split("=");if(1<X.length){var Rt=X[0];X=X[1];var Pt=Rt.split("_");M=2<=Pt.length&&Pt[1]=="type"?M+(Rt+"="+X+"&"):M+(Rt+"=redacted&")}}else M=null;else M=R;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+c+`
`+h+`
`+M})}function yf(o,c,h,m,E,R,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+c+`
`+h+`
`+R+" "+M})}function cn(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+wf(o,h)+(m?" "+m:"")})}function _f(o,c){o.info(function(){return"TIMEOUT: "+c})}ar.prototype.info=function(){};function wf(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var R=E[0];if(R!="noop"&&R!="stop"&&R!="close")for(var M=1;M<E.length;M++)E[M]=""}}}}return Ws(h)}catch{return c}}var ci={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},yc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ys;function li(){}N(li,Hs),li.prototype.g=function(){return new XMLHttpRequest},li.prototype.i=function(){return{}},Ys=new li;function fe(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new rr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new _c}function _c(){this.i=null,this.g="",this.h=!1}var wc={},Zs={};function to(o,c,h){o.L=1,o.v=mi(ee(c)),o.m=h,o.P=!0,vc(o,null)}function vc(o,c){o.F=Date.now(),hi(o),o.A=ee(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),kc(h.i,"t",m),o.C=0,h=o.j.J,o.h=new _c,o.g=Yc(o.j,h?c:null,!o.m),0<o.O&&(o.M=new ff(w(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(cc[0]=E.toString()),E=cc);for(var R=0;R<E.length;R++){var M=nc(h,E[R],m||c.handleEvent,!1,c.h||c);if(!M)break;c.g[M.key]=M}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),sr(),pf(o.i,o.u,o.A,o.l,o.R,o.m)}fe.prototype.ca=function(o){o=o.target;let c=this.M;c&&ne(o)==3?c.j():this.Y(o)},fe.prototype.Y=function(o){try{if(o==this.g)t:{let Pt=ne(this.g);var c=this.g.Ba();let dn=this.g.Z();if(!(3>Pt)&&(Pt!=3||this.g&&(this.h.h||this.g.oa()||Bc(this.g)))){this.J||Pt!=4||c==7||(c==8||0>=dn?sr(3):sr(2)),eo(this);var h=this.g.Z();this.X=h;e:if(Ic(this)){var m=Bc(this.g);o="";var E=m.length,R=ne(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Le(this),ur(this);var M="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(R&&c==E-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,yf(this.i,this.u,this.A,this.l,this.R,Pt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var et,Tt=this.g;if((et=Tt.g?Tt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(et)){var X=et;break e}}X=null}if(h=X)cn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,no(this,h);else{this.o=!1,this.s=3,Dt(12),Le(this),ur(this);break t}}if(this.P){h=!0;let Bt;for(;!this.J&&this.C<M.length;)if(Bt=vf(this,M),Bt==Zs){Pt==4&&(this.s=4,Dt(14),h=!1),cn(this.i,this.l,null,"[Incomplete Response]");break}else if(Bt==wc){this.s=4,Dt(15),cn(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else cn(this.i,this.l,Bt,null),no(this,Bt);if(Ic(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pt!=4||M.length!=0||this.h.h||(this.s=1,Dt(16),h=!1),this.o=this.o&&h,!h)cn(this.i,this.l,M,"[Invalid Chunked Response]"),Le(this),ur(this);else if(0<M.length&&!this.W){this.W=!0;var Rt=this.j;Rt.g==this&&Rt.ba&&!Rt.M&&(Rt.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),uo(Rt),Rt.M=!0,Dt(11))}}else cn(this.i,this.l,M,null),no(this,M);Pt==4&&Le(this),this.o&&!this.J&&(Pt==4?Wc(this.j,this):(this.o=!1,hi(this)))}else Of(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,Dt(12)):(this.s=0,Dt(13)),Le(this),ur(this)}}}catch{}finally{}};function Ic(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function vf(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?Zs:(h=Number(c.substring(h,m)),isNaN(h)?wc:(m+=1,m+h>c.length?Zs:(c=c.slice(m,m+h),o.C=m+h,c)))}fe.prototype.cancel=function(){this.J=!0,Le(this)};function hi(o){o.S=Date.now()+o.I,Tc(o,o.I)}function Tc(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=or(w(o.ba,o),c)}function eo(o){o.B&&(u.clearTimeout(o.B),o.B=null)}fe.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(_f(this.i,this.A),this.L!=2&&(sr(),Dt(17)),Le(this),this.s=2,ur(this)):Tc(this,this.S-o)};function ur(o){o.j.G==0||o.J||Wc(o.j,o)}function Le(o){eo(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,lc(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function no(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||ro(h.h,o))){if(!o.K&&ro(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)wi(h),yi(h);else break t;ao(h),Dt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=or(w(h.Za,h),6e3));if(1>=Sc(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Ue(h,11)}else if((o.K||h.g==o)&&wi(h),!z(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let X=E[c];if(h.T=X[0],X=X[1],h.G==2)if(X[0]=="c"){h.K=X[1],h.ia=X[2];let Rt=X[3];Rt!=null&&(h.la=Rt,h.j.info("VER="+h.la));let Pt=X[4];Pt!=null&&(h.Aa=Pt,h.j.info("SVER="+h.Aa));let dn=X[5];dn!=null&&typeof dn=="number"&&0<dn&&(m=1.5*dn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Bt=o.g;if(Bt){let Ii=Bt.g?Bt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ii){var R=m.h;R.g||Ii.indexOf("spdy")==-1&&Ii.indexOf("quic")==-1&&Ii.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(io(R,R.h),R.h=null))}if(m.D){let co=Bt.g?Bt.g.getResponseHeader("X-HTTP-Session-Id"):null;co&&(m.ya=co,rt(m.I,m.D,co))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var M=o;if(m.qa=Xc(m,m.J?m.ia:null,m.W),M.K){bc(m.h,M);var et=M,Tt=m.L;Tt&&(et.I=Tt),et.B&&(eo(et),hi(et)),m.g=M}else Qc(m);0<h.i.length&&_i(h)}else X[0]!="stop"&&X[0]!="close"||Ue(h,7);else h.G==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?Ue(h,7):oo(h):X[0]!="noop"&&h.l&&h.l.ta(X),h.v=0)}}sr(4)}catch{}}var If=class{constructor(o,c){this.g=o,this.map=c}};function Ec(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ac(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Sc(o){return o.h?1:o.g?o.g.size:0}function ro(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function io(o,c){o.g?o.g.add(c):o.h=c}function bc(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Ec.prototype.cancel=function(){if(this.i=Rc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Rc(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function Tf(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function Ef(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function Pc(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Ef(o),m=Tf(o),E=m.length,R=0;R<E;R++)c.call(void 0,m[R],h&&h[R],o)}var Vc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Af(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var R=o[h].substring(0,m);E=o[h].substring(m+1)}else R=o[h];c(R,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function qe(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof qe){this.h=o.h,di(this,o.j),this.o=o.o,this.g=o.g,fi(this,o.s),this.l=o.l;var c=o.i,h=new hr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),Cc(this,h),this.m=o.m}else o&&(c=String(o).match(Vc))?(this.h=!1,di(this,c[1]||"",!0),this.o=cr(c[2]||""),this.g=cr(c[3]||"",!0),fi(this,c[4]),this.l=cr(c[5]||"",!0),Cc(this,c[6]||"",!0),this.m=cr(c[7]||"")):(this.h=!1,this.i=new hr(null,this.h))}qe.prototype.toString=function(){var o=[],c=this.j;c&&o.push(lr(c,xc,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(lr(c,xc,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(lr(h,h.charAt(0)=="/"?Rf:bf,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",lr(h,Vf)),o.join("")};function ee(o){return new qe(o)}function di(o,c,h){o.j=h?cr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function fi(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Cc(o,c,h){c instanceof hr?(o.i=c,Cf(o.i,o.h)):(h||(c=lr(c,Pf)),o.i=new hr(c,o.h))}function rt(o,c,h){o.i.set(c,h)}function mi(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function cr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function lr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Sf),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Sf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var xc=/[#\/\?@]/g,bf=/[#\?:]/g,Rf=/[#\?]/g,Pf=/[#\?@]/g,Vf=/#/g;function hr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function me(o){o.g||(o.g=new Map,o.h=0,o.i&&Af(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=hr.prototype,r.add=function(o,c){me(this),this.i=null,o=ln(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Dc(o,c){me(o),c=ln(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Nc(o,c){return me(o),c=ln(o,c),o.g.has(c)}r.forEach=function(o,c){me(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(c,E,m,this)},this)},this)},r.na=function(){me(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let E=o[m];for(let R=0;R<E.length;R++)h.push(c[m])}return h},r.V=function(o){me(this);let c=[];if(typeof o=="string")Nc(this,o)&&(c=c.concat(this.g.get(ln(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return me(this),this.i=null,o=ln(this,o),Nc(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function kc(o,c,h){Dc(o,c),0<h.length&&(o.i=null,o.g.set(ln(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let R=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var E=R;M[m]!==""&&(E+="="+encodeURIComponent(String(M[m]))),o.push(E)}}return this.i=o.join("&")};function ln(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Cf(o,c){c&&!o.j&&(me(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(Dc(this,m),kc(this,E,h))},o)),o.j=c}function xf(o,c){let h=new ar;if(u.Image){let m=new Image;m.onload=b(ge,h,"TestLoadImage: loaded",!0,c,m),m.onerror=b(ge,h,"TestLoadImage: error",!1,c,m),m.onabort=b(ge,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=b(ge,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function Df(o,c){let h=new ar,m=new AbortController,E=setTimeout(()=>{m.abort(),ge(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(R=>{clearTimeout(E),R.ok?ge(h,"TestPingServer: ok",!0,c):ge(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),ge(h,"TestPingServer: error",!1,c)})}function ge(o,c,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function Nf(){this.g=new gf}function kf(o,c,h){let m=h||"";try{Pc(o,function(E,R){let M=E;d(E)&&(M=Ws(E)),c.push(m+R+"="+encodeURIComponent(M))})}catch(E){throw c.push(m+"type="+encodeURIComponent("_badmap")),E}}function dr(o){this.l=o.Ub||null,this.j=o.eb||!1}N(dr,Hs),dr.prototype.g=function(){return new gi(this.l,this.j)},dr.prototype.i=function(o){return function(){return o}}({});function gi(o,c){bt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(gi,bt),r=gi.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,mr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,mr(this)),this.g&&(this.readyState=3,mr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Mc(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Mc(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?fr(this):mr(this),this.readyState==3&&Mc(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,fr(this))},r.Qa=function(o){this.g&&(this.response=o,fr(this))},r.ga=function(){this.g&&fr(this)};function fr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,mr(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function mr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(gi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Fc(o){let c="";return Q(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function so(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=Fc(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,c,h))}function ot(o){bt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(ot,bt);var Mf=/^https?$/i,Ff=["POST","PUT"];r=ot.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ys.g(),this.v=this.o?hc(this.o):hc(Ys),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){Oc(this,R);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let R of m.keys())h.set(R,m.get(R));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Ff,c,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,M]of h)this.g.setRequestHeader(R,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Uc(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){Oc(this,R)}};function Oc(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Lc(o),pi(o)}function Lc(o){o.A||(o.A=!0,xt(o,"complete"),xt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,xt(this,"complete"),xt(this,"abort"),pi(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pi(this,!0)),ot.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?qc(this):this.bb())},r.bb=function(){qc(this)};function qc(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ne(o)!=4||o.Z()!=2)){if(o.u&&ne(o)==4)ac(o.Ea,0,o);else if(xt(o,"readystatechange"),ne(o)==4){o.h=!1;try{let M=o.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=M===0){var E=String(o.D).match(Vc)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!Mf.test(E?E.toLowerCase():"")}h=m}if(h)xt(o,"complete"),xt(o,"success");else{o.m=6;try{var R=2<ne(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",Lc(o)}}finally{pi(o)}}}}function pi(o,c){if(o.g){Uc(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||xt(o,"ready");try{h.onreadystatechange=m}catch{}}}function Uc(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ne(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ne(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),mf(c)}};function Bc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Of(o){let c={};o=(o.g&&2<=ne(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(z(o[m]))continue;var h=T(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let R=c[E]||[];c[E]=R,R.push(h)}v(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function gr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Gc(o){this.Aa=0,this.i=[],this.j=new ar,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=gr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=gr("baseRetryDelayMs",5e3,o),this.cb=gr("retryDelaySeedMs",1e4,o),this.Wa=gr("forwardChannelMaxRetries",2,o),this.wa=gr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Ec(o&&o.concurrentRequestLimit),this.Da=new Nf,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Gc.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){Dt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=Xc(this,null,this.W),_i(this)};function oo(o){if(zc(o),o.G==3){var c=o.U++,h=ee(o.I);if(rt(h,"SID",o.K),rt(h,"RID",c),rt(h,"TYPE","terminate"),pr(o,h),c=new fe(o,o.j,c),c.L=2,c.v=mi(ee(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=Yc(c.j,null),c.g.ea(c.v)),c.F=Date.now(),hi(c)}Jc(o)}function yi(o){o.g&&(uo(o),o.g.cancel(),o.g=null)}function zc(o){yi(o),o.u&&(u.clearTimeout(o.u),o.u=null),wi(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function _i(o){if(!Ac(o.h)&&!o.s){o.s=!0;var c=o.Ga;Zn||ec(),tr||(Zn(),tr=!0),qs.add(c,o),o.B=0}}function Lf(o,c){return Sc(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=or(w(o.Ga,o,c),Hc(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new fe(this,this.j,o),R=this.o;if(this.S&&(R?(R=p(R),I(R,this.S)):R=this.S),this.m!==null||this.O||(E.H=R,R=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=Kc(this,E,c),h=ee(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),pr(this,h),R&&(this.O?c="headers="+encodeURIComponent(String(Fc(R)))+"&"+c:this.m&&so(h,this.m,R)),io(this.h,E),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",c),rt(h,"SID","null"),E.T=!0,to(E,h,null)):to(E,h,c),this.G=2}}else this.G==3&&(o?jc(this,o):this.i.length==0||Ac(this.h)||jc(this))};function jc(o,c){var h;c?h=c.l:h=o.U++;let m=ee(o.I);rt(m,"SID",o.K),rt(m,"RID",h),rt(m,"AID",o.T),pr(o,m),o.m&&o.o&&so(m,o.m,o.o),h=new fe(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Kc(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),io(o.h,h),to(h,m,c)}function pr(o,c){o.H&&Q(o.H,function(h,m){rt(c,m,h)}),o.l&&Pc({},function(h,m){rt(c,m,h)})}function Kc(o,c,h){h=Math.min(o.i.length,h);var m=o.l?w(o.l.Na,o.l,o):null;t:{var E=o.i;let R=-1;for(;;){let M=["count="+h];R==-1?0<h?(R=E[0].g,M.push("ofs="+R)):R=0:M.push("ofs="+R);let et=!0;for(let Tt=0;Tt<h;Tt++){let X=E[Tt].g,Rt=E[Tt].map;if(X-=R,0>X)R=Math.max(0,E[Tt].g-100),et=!1;else try{kf(Rt,M,"req"+X+"_")}catch{m&&m(Rt)}}if(et){m=M.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function Qc(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Zn||ec(),tr||(Zn(),tr=!0),qs.add(c,o),o.v=0}}function ao(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=or(w(o.Fa,o),Hc(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,$c(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=or(w(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Dt(10),yi(this),$c(this))};function uo(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function $c(o){o.g=new fe(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=ee(o.qa);rt(c,"RID","rpc"),rt(c,"SID",o.K),rt(c,"AID",o.T),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(c,"TO",o.ja),rt(c,"TYPE","xmlhttp"),pr(o,c),o.m&&o.o&&so(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=mi(ee(c)),h.m=null,h.P=!0,vc(h,o)}r.Za=function(){this.C!=null&&(this.C=null,yi(this),ao(this),Dt(19))};function wi(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Wc(o,c){var h=null;if(o.g==c){wi(o),uo(o),o.g=null;var m=2}else if(ro(o.h,c))h=c.D,bc(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;m=ui(),xt(m,new pc(m,h)),_i(o)}else Qc(o);else if(E=c.s,E==3||E==0&&0<c.X||!(m==1&&Lf(o,c)||m==2&&ao(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:Ue(o,5);break;case 4:Ue(o,10);break;case 3:Ue(o,6);break;default:Ue(o,2)}}}function Hc(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function Ue(o,c){if(o.j.info("Error code "+c),c==2){var h=w(o.fb,o),m=o.Xa;let E=!m;m=new qe(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||di(m,"https"),mi(m),E?xf(m.toString(),h):Df(m.toString(),h)}else Dt(2);o.G=0,o.l&&o.l.sa(c),Jc(o),zc(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Dt(2)):(this.j.info("Failed to ping google.com"),Dt(1))};function Jc(o){if(o.G=0,o.ka=[],o.l){let c=Rc(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ka,c),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Xc(o,c,h){var m=h instanceof qe?ee(h):new qe(h);if(m.g!="")c&&(m.g=c+"."+m.g),fi(m,m.s);else{var E=u.location;m=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var R=new qe(null);m&&di(R,m),c&&(R.g=c),E&&fi(R,E),h&&(R.l=h),m=R}return h=o.D,c=o.ya,h&&c&&rt(m,h,c),rt(m,"VER",o.la),pr(o,m),m}function Yc(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ot(new dr({eb:h})):new ot(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Zc(){}r=Zc.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function vi(){}vi.prototype.g=function(o,c){return new Ft(o,c)};function Ft(o,c){bt.call(this),this.g=new Gc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!z(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!z(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new hn(this)}N(Ft,bt),Ft.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ft.prototype.close=function(){oo(this.g)},Ft.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Ws(o),o=h);c.i.push(new If(c.Ya++,o)),c.G==3&&_i(c)},Ft.prototype.N=function(){this.g.l=null,delete this.j,oo(this.g),delete this.g,Ft.aa.N.call(this)};function tl(o){Js.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}N(tl,Js);function el(){Xs.call(this),this.status=1}N(el,Xs);function hn(o){this.g=o}N(hn,Zc),hn.prototype.ua=function(){xt(this.g,"a")},hn.prototype.ta=function(o){xt(this.g,new tl(o))},hn.prototype.sa=function(o){xt(this.g,new el)},hn.prototype.ra=function(){xt(this.g,"b")},vi.prototype.createWebChannel=vi.prototype.g,Ft.prototype.send=Ft.prototype.o,Ft.prototype.open=Ft.prototype.m,Ft.prototype.close=Ft.prototype.close,Io=re.createWebChannelTransport=function(){return new vi},vo=re.getStatEventTarget=function(){return ui()},wo=re.Event=Oe,Ei=re.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ci.NO_ERROR=0,ci.TIMEOUT=8,ci.HTTP_ERROR=6,_r=re.ErrorCode=ci,yc.COMPLETE="complete",_o=re.EventType=yc,dc.EventType=ir,ir.OPEN="a",ir.CLOSE="b",ir.ERROR="c",ir.MESSAGE="d",bt.prototype.listen=bt.prototype.K,fn=re.WebChannel=dc,yo=re.FetchXmlHttpFactory=dr,ot.prototype.listenOnce=ot.prototype.L,ot.prototype.getLastError=ot.prototype.Ka,ot.prototype.getLastErrorCode=ot.prototype.Ba,ot.prototype.getStatus=ot.prototype.Z,ot.prototype.getResponseJson=ot.prototype.Oa,ot.prototype.getResponseText=ot.prototype.oa,ot.prototype.send=ot.prototype.ea,ot.prototype.setWithCredentials=ot.prototype.Ha,po=re.XhrIo=ot}).apply(typeof Ti<"u"?Ti:typeof self<"u"?self:typeof window<"u"?window:{});var yl="@firebase/firestore";var gt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};gt.UNAUTHENTICATED=new gt(null),gt.GOOGLE_CREDENTIALS=new gt("google-credentials-uid"),gt.FIRST_PARTY=new gt("first-party-uid"),gt.MOCK_USER=new gt("mock-user");var Qn="10.12.1";var Te=new cl("@firebase/firestore");function _n(){return Te.logLevel}function Yg(r){Te.setLogLevel(r)}function C(r,...t){if(Te.logLevel<=jt.DEBUG){let e=t.map(Au);Te.debug(`Firestore (${Qn}): ${r}`,...e)}}function ct(r,...t){if(Te.logLevel<=jt.ERROR){let e=t.map(Au);Te.error(`Firestore (${Qn}): ${r}`,...e)}}function Jt(r,...t){if(Te.logLevel<=jt.WARN){let e=t.map(Au);Te.warn(`Firestore (${Qn}): ${r}`,...e)}}function Au(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r="Unexpected state"){let t=`FIRESTORE (${Qn}) INTERNAL ASSERTION FAILED: `+r;throw ct(t),new Error(t)}function q(r,t){r||L()}function Zg(r,t){r||L()}function F(r,t){return r}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends al{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var pt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var ki=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},bo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(gt.UNAUTHENTICATED))}shutdown(){}},Ro=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Po=class{constructor(t){this.t=t,this.currentUser=gt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i,i=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),s=new pt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new pt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;t.enqueueRetryable(()=>V(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new pt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new ki(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new gt(t)}},Vo=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=gt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Co=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Vo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(gt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},xo=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Do=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let n=s=>{s.error!=null&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,C("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string"),this.R=e.token,new xo(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function qf(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Mi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=qf(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function j(r,t){return r<t?-1:r>t?1:0}function Pn(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function _h(r){return r+"\0"}var lt=class r{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?j(this.nanoseconds,t.nanoseconds):j(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var U=class r{constructor(t){this.timestamp=t}static fromTimestamp(t){return new r(t)}static min(){return new r(new lt(0,0))}static max(){return new r(new lt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Fi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(),n===void 0?n=t.length-e:n>t.length-e&&L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},J=class r extends Fi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},Uf=/^[_a-zA-Z][_a-zA-Z0-9]*$/,wt=class r extends Fi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return Uf.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var O=class r{constructor(t){this.path=t}static fromPath(t){return new r(J.fromString(t))}static fromName(t){return new r(J.fromString(t).popFirst(5))}static empty(){return new r(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&J.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return J.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new J(t.slice()))}};var Vn=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function No(r){return r.fields.find(t=>t.kind===2)}function Ge(r){return r.fields.filter(t=>t.kind!==2)}Vn.UNKNOWN_ID=-1;var An=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var Cr=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Ut.min())}};function wh(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=U.fromTimestamp(n===1e9?new lt(e+1,0):new lt(e,n));return new Ut(i,O.empty(),t)}function vh(r){return new Ut(r.readTime,r.key,-1)}var Ut=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),O.empty(),-1)}static max(){return new r(U.max(),O.empty(),-1)}};function Su(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(r.documentKey,t.documentKey),e!==0?e:j(r.largestBatchId,t.largestBatchId))}var Ih="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Oi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function ke(r){return V(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==Ih)throw r;C("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},l=>n(l))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var Li=class r{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new pt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new We(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=bu(n.target.error);this.V.reject(new We(t,i))}}static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new We(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(C("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Mo(e)}},Ee=class r{constructor(t,e,n){this.name=t,this.version=e,this.p=n,r.S(yr())===12.2&&ct("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return C("SimpleDb","Removing database:",t),ze(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!ol())return!1;if(r.C())return!0;let t=yr(),e=r.S(t),n=0<e&&e<10,i=Th(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.v)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(t){return V(this,null,function*(){return this.db||(C("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new We(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new We(t,a))},i.onupgradeneeded=s=>{C("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{C("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,i){return V(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(t);let u=Li.open(this.db,t,s?"readonly":"readwrite",n),l=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return l.catch(()=>{}),yield u.m,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(C("SimpleDb","Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Th(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var ko=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return ze(this.B.delete())}},We=class extends x{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Me(r){return r.name==="IndexedDbTransactionError"}var Mo=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(C("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(C("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ze(n)}add(t){return C("SimpleDb","ADD",this.store.name,t,t),ze(this.store.add(t))}get(t){return ze(this.store.get(t)).next(e=>(e===void 0&&(e=null),C("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return C("SimpleDb","DELETE",this.store.name,t),ze(this.store.delete(t))}count(){return C("SimpleDb","COUNT",this.store.name),ze(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,l)=>{a.push(l)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){C("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new S((n,i)=>{e.onerror=s=>{let a=bu(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new S((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let l=new ko(u),d=e(u.primaryKey,u.value,l);if(d instanceof S){let f=d.catch(g=>(l.done(),S.reject(g)));n.push(f)}l.isDone?i():l.K===null?u.continue():u.continue(l.K)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function ze(r){return new S((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=bu(n.target.error);e(i)}})}var _l=!1;function bu(r){let t=Ee.S(yr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return _l||(_l=!0,setTimeout(()=>{throw n},0)),n}}return r}var Fo=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){C("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{C("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){Me(e)?C("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield ke(e)}yield this.X(6e4)}))}},Oo=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let n=new Set,i=e,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return C("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(C("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=vh(s);Su(a,n)>0&&(n=a)}),new Ut(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ot=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function Zr(r){return r==null}function xr(r){return r===0&&1/r==-1/0}function Eh(r){return typeof r=="number"&&Number.isInteger(r)&&!xr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Nt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=wl(t)),t=Bf(r.get(e),t);return wl(t)}function Bf(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function wl(r){return r+""}function Kt(r){let t=r.length;if(q(t>=2),t===2)return q(r.charAt(0)===""&&r.charAt(1)===""),J.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&L(),r.charAt(a+1)){case"":let u=r.substring(s,a),l;i.length===0?l=u:(i+=u,l=i,i=""),n.push(l);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}var vl=["userId","batchId"];function Pi(r,t){return[r,Nt(t)]}function Ah(r,t,e){return[r,Nt(t),e]}var Gf={},zf=["prefixPath","collectionGroup","readTime","documentId"],jf=["prefixPath","collectionGroup","documentId"],Kf=["collectionGroup","readTime","prefixPath","documentId"],Qf=["canonicalId","targetId"],$f=["targetId","path"],Wf=["path","targetId"],Hf=["collectionId","parent"],Jf=["indexId","uid"],Xf=["uid","sequenceNumber"],Yf=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Zf=["indexId","uid","orderedDocumentKey"],tm=["userId","collectionPath","documentId"],em=["userId","collectionPath","largestBatchId"],nm=["userId","collectionGroup","largestBatchId"],Sh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],rm=[...Sh,"documentOverlays"],bh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Rh=bh,Ph=[...Rh,"indexConfiguration","indexState","indexEntries"],im=Ph;var Dr=class extends Oi{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function It(r,t){let e=F(r);return Ee.F(e._e,t)}function Il(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function on(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Vh(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var it=class r{constructor(t,e){this.comparator=t,this.root=e||$t.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,$t.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,$t.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new En(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new En(this.root,t,this.comparator,!1)}getReverseIterator(){return new En(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new En(this.root,t,this.comparator,!0)}},En=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},$t=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}};$t.EMPTY=null,$t.RED=!0,$t.BLACK=!1;$t.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(t,e,n,i,s){return this}insert(t,e,n){return new $t(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var nt=class r{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new qi(this.data.getIterator())}getIteratorFrom(t){return new qi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},qi=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function mn(r){return r.hasNext()?r.getNext():void 0}var Lt=class r{constructor(t){this.fields=t,t.sort(wt.comparator)}static empty(){return new r([])}unionWith(t){let e=new nt(wt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Pn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Ui=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function ep(){return typeof atob<"u"}var vt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ui("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return j(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};vt.EMPTY_BYTE_STRING=new vt("");var sm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oe(r){if(q(!!r),typeof r=="string"){let t=0,e=sm.exec(r);if(q(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:at(r.seconds),nanos:at(r.nanos)}}function at(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Ae(r){return typeof r=="string"?vt.fromBase64String(r):vt.fromUint8Array(r)}function Cs(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Ru(r){let t=r.mapValue.fields.__previous_value__;return Cs(t)?Ru(t):t}function Nr(r){let t=oe(r.mapValue.fields.__local_write_time__.timestampValue);return new lt(t.seconds,t.nanos)}var Lo=class{constructor(t,e,n,i,s,a,u,l,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d}},Cn=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Ie={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Vi={nullValue:"NULL_VALUE"};function He(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Cs(r)?4:Ch(r)?9007199254740991:10:L()}function Xt(r,t){if(r===t)return!0;let e=He(r);if(e!==He(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Nr(r).isEqual(Nr(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=oe(i.timestampValue),u=oe(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return Ae(i.bytesValue).isEqual(Ae(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return at(i.geoPointValue.latitude)===at(s.geoPointValue.latitude)&&at(i.geoPointValue.longitude)===at(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return at(i.integerValue)===at(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=at(i.doubleValue),u=at(s.doubleValue);return a===u?xr(a)===xr(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return Pn(r.arrayValue.values||[],t.arrayValue.values||[],Xt);case 10:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Il(a)!==Il(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!Xt(a[l],u[l])))return!1;return!0}(r,t);default:return L()}}function kr(r,t){return(r.values||[]).find(e=>Xt(e,t))!==void 0}function Se(r,t){if(r===t)return 0;let e=He(r),n=He(t);if(e!==n)return j(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return j(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=at(s.integerValue||s.doubleValue),l=at(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return Tl(r.timestampValue,t.timestampValue);case 4:return Tl(Nr(r),Nr(t));case 5:return j(r.stringValue,t.stringValue);case 6:return function(s,a){let u=Ae(s),l=Ae(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=j(u[d],l[d]);if(f!==0)return f}return j(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=j(at(s.latitude),at(a.latitude));return u!==0?u:j(at(s.longitude),at(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return function(s,a){let u=s.values||[],l=a.values||[];for(let d=0;d<u.length&&d<l.length;++d){let f=Se(u[d],l[d]);if(f)return f}return j(u.length,l.length)}(r.arrayValue,t.arrayValue);case 10:return function(s,a){if(s===Ie.mapValue&&a===Ie.mapValue)return 0;if(s===Ie.mapValue)return 1;if(a===Ie.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){let w=j(l[g],f[g]);if(w!==0)return w;let b=Se(u[l[g]],d[f[g]]);if(b!==0)return b}return j(l.length,f.length)}(r.mapValue,t.mapValue);default:throw L()}}function Tl(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return j(r,t);let e=oe(r),n=oe(t),i=j(e.seconds,n.seconds);return i!==0?i:j(e.nanos,n.nanos)}function xn(r){return qo(r)}function qo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=oe(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Ae(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return O.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=qo(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${qo(e.fields[a])}`;return i+"}"}(r.mapValue):L()}function Je(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Uo(r){return!!r&&"integerValue"in r}function Mr(r){return!!r&&"arrayValue"in r}function El(r){return!!r&&"nullValue"in r}function Al(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ci(r){return!!r&&"mapValue"in r}function Sr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return on(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Sr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Sr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Ch(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function om(r){return"nullValue"in r?Vi:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Je(Cn.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:L()}function am(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Je(Cn.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?Ie:L()}function Sl(r,t){let e=Se(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function bl(r,t){let e=Se(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Ct=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ci(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Sr(e)}setAll(t){let e=wt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=Sr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());Ci(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Xt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Ci(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){on(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(Sr(this.value))}};function xh(r){let t=[];return on(r.fields,(e,n)=>{let i=new wt([e]);if(Ci(n)){let s=xh(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Lt(t)}var yt=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Ct.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,U.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Ct.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Ct.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ct.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Yt=class{constructor(t,e){this.position=t,this.inclusive=e}};function Rl(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),e.key):n=Se(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Pl(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Xt(r.position[e],t.position[e]))return!1;return!0}var Xe=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function um(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Bi=class{},$=class r extends Bi{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new zo(t,e,n):e==="array-contains"?new Qo(t,n):e==="in"?new Gi(t,n):e==="not-in"?new $o(t,n):e==="array-contains-any"?new Wo(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new jo(t,n):new Ko(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Se(e,this.value)):e!==null&&He(this.value)===He(e)&&this.matchesComparison(Se(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends Bi{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return Dn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Dn(r){return r.op==="and"}function Bo(r){return r.op==="or"}function Pu(r){return Dh(r)&&Dn(r)}function Dh(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function Go(r){if(r instanceof $)return r.field.canonicalString()+r.op.toString()+xn(r.value);if(Pu(r))return r.filters.map(t=>Go(t)).join(",");{let t=r.filters.map(e=>Go(e)).join(",");return`${r.op}(${t})`}}function Nh(r,t){return r instanceof $?function(n,i){return i instanceof $&&n.op===i.op&&n.field.isEqual(i.field)&&Xt(n.value,i.value)}(r,t):r instanceof tt?function(n,i){return i instanceof tt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Nh(a,i.filters[u]),!0):!1}(r,t):void L()}function kh(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function Mh(r){return r instanceof $?function(e){return`${e.field.canonicalString()} ${e.op} ${xn(e.value)}`}(r):r instanceof tt?function(e){return e.op.toString()+" {"+e.getFilters().map(Mh).join(" ,")+"}"}(r):"Filter"}var zo=class extends ${constructor(t,e,n){super(t,e,n),this.key=O.fromName(n.referenceValue)}matches(t){let e=O.comparator(t.key,this.key);return this.matchesComparison(e)}},jo=class extends ${constructor(t,e){super(t,"in",e),this.keys=Fh("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ko=class extends ${constructor(t,e){super(t,"not-in",e),this.keys=Fh("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Fh(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>O.fromName(n.referenceValue))}var Qo=class extends ${constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Mr(e)&&kr(e.arrayValue,this.value)}},Gi=class extends ${constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&kr(this.value.arrayValue,e)}},$o=class extends ${constructor(t,e){super(t,"not-in",e)}matches(t){if(kr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!kr(this.value.arrayValue,e)}},Wo=class extends ${constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Mr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>kr(this.value.arrayValue,n))}};var Ho=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function Jo(r,t=null,e=[],n=[],i=null,s=null,a=null){return new Ho(r,t,e,n,i,s,a)}function Ye(r){let t=F(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Go(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Zr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>xn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>xn(n)).join(",")),t.ue=e}return t.ue}function ti(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!um(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Nh(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Pl(r.startAt,t.startAt)&&Pl(r.endAt,t.endAt)}function zi(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ji(r,t){return r.filters.filter(e=>e instanceof $&&e.field.isEqual(t))}function Vl(r,t,e){let n=Vi,i=!0;for(let s of ji(r,t)){let a=Vi,u=!0;switch(s.op){case"<":case"<=":a=om(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Vi}Sl({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Sl({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Cl(r,t,e){let n=Ie,i=!0;for(let s of ji(r,t)){let a=Ie,u=!0;switch(s.op){case">=":case">":a=am(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ie}bl({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];bl({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var Gt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Oh(r,t,e,n,i,s,a,u){return new Gt(r,t,e,n,i,s,a,u)}function $n(r){return new Gt(r)}function xl(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Vu(r){return r.collectionGroup!==null}function Sn(r){let t=F(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new nt(wt.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new Xe(s,n))}),e.has(wt.keyField().canonicalString())||t.ce.push(new Xe(wt.keyField(),n))}return t.ce}function kt(r){let t=F(r);return t.le||(t.le=cm(t,Sn(r))),t.le}function cm(r,t){if(r.limitType==="F")return Jo(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Xe(i.field,s)});let e=r.endAt?new Yt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Yt(r.startAt.position,r.startAt.inclusive):null;return Jo(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Xo(r,t){let e=r.filters.concat([t]);return new Gt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Ki(r,t,e){return new Gt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function ei(r,t){return ti(kt(r),kt(t))&&r.limitType===t.limitType}function Lh(r){return`${Ye(kt(r))}|lt:${r.limitType}`}function wn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>Mh(i)).join(", ")}]`),Zr(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>xn(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>xn(i)).join(",")),`Target(${n})`}(kt(r))}; limitType=${r.limitType})`}function ni(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of Sn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,l){let d=Rl(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,Sn(n),i)||n.endAt&&!function(a,u,l){let d=Rl(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,Sn(n),i))}(r,t)}function qh(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Uh(r){return(t,e)=>{let n=!1;for(let i of Sn(r)){let s=lm(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function lm(r,t,e){let n=r.field.isKeyField()?O.comparator(t.key,e.key):function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?Se(l,d):L()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}var Zt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){on(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Vh(this.inner)}size(){return this.innerSize}};var hm=new it(O.comparator);function Mt(){return hm}var Bh=new it(O.comparator);function Er(...r){let t=Bh;for(let e of r)t=t.insert(e.key,e);return t}function Gh(r){let t=Bh;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Qt(){return br()}function zh(){return br()}function br(){return new Zt(r=>r.toString(),(r,t)=>r.isEqual(t))}var dm=new it(O.comparator),fm=new nt(O.comparator);function K(...r){let t=fm;for(let e of r)t=t.add(e);return t}var mm=new nt(j);function Cu(){return mm}function jh(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xr(t)?"-0":t}}function Kh(r){return{integerValue:""+r}}function Qh(r,t){return Eh(t)?Kh(t):jh(r,t)}var Nn=class{constructor(){this._=void 0}};function gm(r,t,e){return r instanceof be?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Cs(s)&&(s=Ru(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof ae?Wh(r,t):r instanceof ue?Hh(r,t):function(i,s){let a=$h(i,s),u=Dl(a)+Dl(i.Pe);return Uo(a)&&Uo(i.Pe)?Kh(u):jh(i.serializer,u)}(r,t)}function pm(r,t,e){return r instanceof ae?Wh(r,t):r instanceof ue?Hh(r,t):e}function $h(r,t){return r instanceof Re?function(n){return Uo(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var be=class extends Nn{},ae=class extends Nn{constructor(t){super(),this.elements=t}};function Wh(r,t){let e=Jh(t);for(let n of r.elements)e.some(i=>Xt(i,n))||e.push(n);return{arrayValue:{values:e}}}var ue=class extends Nn{constructor(t){super(),this.elements=t}};function Hh(r,t){let e=Jh(t);for(let n of r.elements)e=e.filter(i=>!Xt(i,n));return{arrayValue:{values:e}}}var Re=class extends Nn{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Dl(r){return at(r.integerValue||r.doubleValue)}function Jh(r){return Mr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Ze=class{constructor(t,e){this.field=t,this.transform=e}};function ym(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof ae&&i instanceof ae||n instanceof ue&&i instanceof ue?Pn(n.elements,i.elements,Xt):n instanceof Re&&i instanceof Re?Xt(n.Pe,i.Pe):n instanceof be&&i instanceof be}(r.transform,t.transform)}var Yo=class{constructor(t,e){this.version=t,this.transformResults=e}},ut=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function xi(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var kn=class{};function Xh(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Ve(r.key,ut.none()):new Pe(r.key,r.data,ut.none());{let e=r.data,n=Ct.empty(),i=new nt(wt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new zt(r.key,n,new Lt(i.toArray()),ut.none())}}function _m(r,t,e){r instanceof Pe?function(i,s,a){let u=i.value.clone(),l=kl(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof zt?function(i,s,a){if(!xi(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=kl(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Yh(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Rr(r,t,e,n){return r instanceof Pe?function(s,a,u,l){if(!xi(s.precondition,a))return u;let d=s.value.clone(),f=Ml(s.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof zt?function(s,a,u,l){if(!xi(s.precondition,a))return u;let d=Ml(s.fieldTransforms,l,a),f=a.data;return f.setAll(Yh(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return xi(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function wm(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=$h(n.transform,i||null);s!=null&&(e===null&&(e=Ct.empty()),e.set(n.field,s))}return e||null}function Nl(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Pn(n,i,(s,a)=>ym(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Pe=class extends kn{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},zt=class extends kn{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Yh(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function kl(r,t,e){let n=new Map;q(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,pm(a,u,e[i]))}return n}function Ml(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,gm(s,a,t))}return n}var Ve=class extends kn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Fr=class extends kn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Or=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&_m(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Rr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Rr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=zh();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let l=Xh(a,u);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&Pn(this.mutations,t.mutations,(e,n)=>Nl(e,n))&&Pn(this.baseMutations,t.baseMutations,(e,n)=>Nl(e,n))}},Zo=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){q(t.mutations.length===n.length);let i=function(){return dm}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var Lr=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ta=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ft,H;function Zh(r){switch(r){default:return L();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function td(r){if(r===void 0)return ct("GRPC error has no .code"),P.UNKNOWN;switch(r){case ft.OK:return P.OK;case ft.CANCELLED:return P.CANCELLED;case ft.UNKNOWN:return P.UNKNOWN;case ft.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ft.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ft.INTERNAL:return P.INTERNAL;case ft.UNAVAILABLE:return P.UNAVAILABLE;case ft.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ft.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ft.NOT_FOUND:return P.NOT_FOUND;case ft.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ft.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ft.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ft.ABORTED:return P.ABORTED;case ft.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ft.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ft.DATA_LOSS:return P.DATA_LOSS;default:return L()}}(H=ft||(ft={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var Fl=null;function ed(){return new TextEncoder}var vm=new pe([4294967295,4294967295],0);function Ol(r){let t=ed().encode(r),e=new go;return e.update(t),new Uint8Array(e.digest())}function Ll(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new pe([e,n],0),new pe([i,s],0)]}var ea=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new $e(`Invalid padding: ${e}`);if(n<0)throw new $e(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new $e(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new $e(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=pe.fromNumber(this.Ie)}Ee(t,e,n){let i=t.add(e.multiply(pe.fromNumber(n)));return i.compare(vm)===1&&(i=new pe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=Ol(t),[n,i]=Ll(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Ie===0)return;let e=Ol(t),[n,i]=Ll(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},$e=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var qr=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,Ur.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),i,new it(j),Mt(),K())}},Ur=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var bn=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},Qi=class{constructor(t,e){this.targetId=t,this.me=e}},$i=class{constructor(t,e,n=vt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},Wi=class{constructor(){this.fe=0,this.ge=Ul(),this.pe=vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=K(),e=K(),n=K();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L()}}),new Ur(this.pe,this.ye,t,e,n)}ve(){this.we=!1,this.ge=Ul()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},na=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Mt(),this.qe=ql(),this.Qe=new it(j)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:L()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,n=t.me.count,i=this.Je(e);if(i){let s=i.target;if(zi(s))if(n===0){let a=new O(s.path);this.Ue(e,a,yt.newNoDocument(a,U.min()))}else q(n===1);else{let a=this.Ye(e);if(a!==n){let u=this.Ze(t),l=u?this.Xe(u,t,a):1;if(l!==0){this.je(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,d)}Fl?.et(function(f,g,w,b,N){var k,D,G,z,B,W;let Z={localCacheCount:f,existenceFilterCount:g.count,databaseId:w.database,projectId:w.projectId},Q=g.unchangedNames;return Q&&(Z.bloomFilter={applied:N===0,hashCount:(k=Q?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(z=(G=(D=Q?.bits)===null||D===void 0?void 0:D.bitmap)===null||G===void 0?void 0:G.length)!==null&&z!==void 0?z:0,padding:(W=(B=Q?.bits)===null||B===void 0?void 0:B.padding)!==null&&W!==void 0?W:0,mightContain:v=>{var p;return(p=b?.mightContain(v))!==null&&p!==void 0&&p}}),Z}(a,t.me,this.Le.tt(),u,l))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=Ae(n).toUint8Array()}catch(l){if(l instanceof Ui)return Jt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new ea(a,i,s)}catch(l){return Jt(l instanceof $e?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.Ie===0?null:u}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&zi(u.target)){let l=new O(u.target.path);this.ke.get(l)!==null||this.it(a,l)||this.Ue(a,l,yt.newNoDocument(l,t))}s.be&&(e.set(a,s.Ce()),s.ve())}});let n=K();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.Je(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new qr(t,e,this.Qe,this.ke,n);return this.ke=Mt(),this.qe=ql(),this.Qe=new it(j),i}$e(t,e){if(!this.ze(t))return;let n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Wi,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new nt(j),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||C("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Wi),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function ql(){return new it(O.comparator)}function Ul(){return new it(O.comparator)}var Im={asc:"ASCENDING",desc:"DESCENDING"},Tm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Em={and:"AND",or:"OR"},ra=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function ia(r,t){return r.useProto3Json||Zr(t)?t:{value:t}}function Mn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function nd(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Am(r,t){return Mn(r,t.toTimestamp())}function ht(r){return q(!!r),U.fromTimestamp(function(e){let n=oe(e);return new lt(n.seconds,n.nanos)}(r))}function xu(r,t){return sa(r,t).canonicalString()}function sa(r,t){let e=function(i){return new J(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function rd(r){let t=J.fromString(r);return q(fd(t)),t}function Br(r,t){return xu(r.databaseId,t.path)}function Wt(r,t){let e=rd(t);if(e.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new O(od(e))}function id(r,t){return xu(r.databaseId,t)}function sd(r){let t=rd(r);return t.length===4?J.emptyPath():od(t)}function oa(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function od(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Bl(r,t,e){return{name:Br(r,t),fields:e.value.mapValue.fields}}function ad(r,t,e){let n=Wt(r,t.name),i=ht(t.updateTime),s=t.createTime?ht(t.createTime):U.min(),a=new Ct({mapValue:{fields:t.fields}}),u=yt.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Sm(r,t){return"found"in t?function(n,i){q(!!i.found),i.found.name,i.found.updateTime;let s=Wt(n,i.found.name),a=ht(i.found.updateTime),u=i.found.createTime?ht(i.found.createTime):U.min(),l=new Ct({mapValue:{fields:i.found.fields}});return yt.newFoundDocument(s,a,u,l)}(r,t):"missing"in t?function(n,i){q(!!i.missing),q(!!i.readTime);let s=Wt(n,i.missing),a=ht(i.readTime);return yt.newNoDocument(s,a)}(r,t):L()}function bm(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string"),vt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),vt.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?P.UNKNOWN:td(d.code);return new x(f,d.message||"")}(a);e=new $i(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=Wt(r,n.document.name),s=ht(n.document.updateTime),a=n.document.createTime?ht(n.document.createTime):U.min(),u=new Ct({mapValue:{fields:n.document.fields}}),l=yt.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new bn(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=Wt(r,n.document),s=n.readTime?ht(n.readTime):U.min(),a=yt.newNoDocument(i,s),u=n.removedTargetIds||[];e=new bn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=Wt(r,n.document),s=n.removedTargetIds||[];e=new bn([],s,i,null)}else{if(!("filter"in t))return L();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new ta(i,s),u=n.targetId;e=new Qi(u,a)}}return e}function Gr(r,t){let e;if(t instanceof Pe)e={update:Bl(r,t.key,t.value)};else if(t instanceof Ve)e={delete:Br(r,t.key)};else if(t instanceof zt)e={update:Bl(r,t.key,t.data),updateMask:Dm(t.fieldMask)};else{if(!(t instanceof Fr))return L();e={verify:Br(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof be)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ae)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ue)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Re)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Am(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L()}(r,t.precondition)),e}function aa(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?ut.updateTime(ht(s.updateTime)):s.exists!==void 0?ut.exists(s.exists):ut.none()}(t.currentDocument):ut.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let l=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),l=new be;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new ae(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new ue(f)}else"increment"in u?l=new Re(a,u.increment):L();let d=wt.fromServerFormat(u.fieldPath);return new Ze(d,l)}(r,i)):[];if(t.update){t.update.name;let i=Wt(r,t.update.name),s=new Ct({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Lt(d.map(f=>wt.fromServerFormat(f)))}(t.updateMask);return new zt(i,s,a,e,n)}return new Pe(i,s,e,n)}if(t.delete){let i=Wt(r,t.delete);return new Ve(i,e)}if(t.verify){let i=Wt(r,t.verify);return new Fr(i,e)}return L()}function Rm(r,t){return r&&r.length>0?(q(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?ht(i.updateTime):ht(s);return a.isEqual(U.min())&&(a=ht(s)),new Yo(a,i.transformResults||[])}(e,t))):[]}function ud(r,t){return{documents:[id(r,t.path)]}}function cd(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=id(r,i);let s=function(d){if(d.length!==0)return dd(tt.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(w){return{field:vn(w.field),direction:Vm(w.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=ia(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{_t:e,parent:i}}function ld(r){let t=sd(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){q(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let w=hd(g);return w instanceof tt&&Pu(w)?w.getFilters():[w]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(w=>function(N){return new Xe(In(N.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(w))}(e.orderBy));let u=null;e.limit&&(u=function(g){let w;return w=typeof g=="object"?g.value:g,Zr(w)?null:w}(e.limit));let l=null;e.startAt&&(l=function(g){let w=!!g.before,b=g.values||[];return new Yt(b,w)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let w=!g.before,b=g.values||[];return new Yt(b,w)}(e.endAt)),Oh(t,i,a,s,u,"F",l,d)}function Pm(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function hd(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=In(e.unaryFilter.field);return $.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=In(e.unaryFilter.field);return $.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=In(e.unaryFilter.field);return $.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=In(e.unaryFilter.field);return $.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):r.fieldFilter!==void 0?function(e){return $.create(In(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return tt.create(e.compositeFilter.filters.map(n=>hd(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(e.compositeFilter.op))}(r):L()}function Vm(r){return Im[r]}function Cm(r){return Tm[r]}function xm(r){return Em[r]}function vn(r){return{fieldPath:r.canonicalString()}}function In(r){return wt.fromServerFormat(r.fieldPath)}function dd(r){return r instanceof $?function(e){if(e.op==="=="){if(Al(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NAN"}};if(El(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Al(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NOT_NAN"}};if(El(e.value))return{unaryFilter:{field:vn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vn(e.field),op:Cm(e.op),value:e.value}}}(r):r instanceof tt?function(e){let n=e.getFilters().map(i=>dd(i));return n.length===1?n[0]:{compositeFilter:{op:xm(e.op),filters:n}}}(r):L()}function Dm(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function fd(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Fn=class r{constructor(t,e,n,i,s=U.min(),a=U.min(),u=vt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Hi=class{constructor(t){this.ct=t}};function Nm(r,t){let e;if(t.document)e=ad(r.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=O.fromSegments(t.noDocument.path),i=en(t.noDocument.readTime);e=yt.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L();{let n=O.fromSegments(t.unknownDocument.path),i=en(t.unknownDocument.version);e=yt.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new lt(i[0],i[1]);return U.fromTimestamp(s)}(t.readTime)),e}function Gl(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Ji(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:Br(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Mn(s,a.version.toTimestamp()),createTime:Mn(s,a.createTime.toTimestamp())}}(r.ct,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:tn(t.version)};else{if(!t.isUnknownDocument())return L();n.unknownDocument={path:e.path.toArray(),version:tn(t.version)}}return n}function Ji(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function tn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function en(r){let t=new lt(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function je(r,t){let e=(t.baseMutations||[]).map(s=>aa(r.ct,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>aa(r.ct,s)),i=lt.fromMillis(t.localWriteTimeMs);return new Or(t.batchId,i,e,n)}function Ar(r){let t=en(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?en(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return q(s.documents.length===1),kt($n(sd(s.documents[0])))}(r.query):function(s){return kt(ld(s))}(r.query),new Fn(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,vt.fromBase64String(r.resumeToken))}function md(r,t){let e=tn(t.snapshotVersion),n=tn(t.lastLimboFreeSnapshotVersion),i;i=zi(t.target)?ud(r.ct,t.target):cd(r.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ye(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Du(r){let t=ld({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Ki(t,t.limit,"L"):t}function To(r,t){return new Lr(t.largestBatchId,aa(r.ct,t.overlayMutation))}function zl(r,t){let e=t.path.lastSegment();return[r,Nt(t.path.popLast()),e]}function jl(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:tn(n.readTime),documentKey:Nt(n.documentKey.path),largestBatchId:n.largestBatchId}}var ua=class{getBundleMetadata(t,e){return Kl(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:en(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return Kl(t).put(function(i){return{bundleId:i.id,createTime:tn(ht(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return Ql(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:Du(s.bundledQuery),readTime:en(s.readTime)}}(n)})}saveNamedQuery(t,e){return Ql(t).put(function(i){return{name:i.name,readTime:tn(ht(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function Kl(r){return It(r,"bundles")}function Ql(r){return It(r,"namedQueries")}var Xi=class r{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return wr(t).get(zl(this.userId,e)).next(n=>n?To(this.serializer,n):null)}getOverlays(t,e){let n=Qt();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new Lr(e,a);i.push(this.ht(t,u))}),S.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(Nt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(wr(t).j("collectionPathOverlayIndex",u))}),S.waitFor(s)}getOverlaysForCollection(t,e,n){let i=Qt(),s=Nt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return wr(t).U("collectionPathOverlayIndex",a).next(u=>{for(let l of u){let d=To(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=Qt(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return wr(t).J({index:"collectionGroupOverlayIndex",range:u},(l,d,f)=>{let g=To(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(t,e){return wr(t).put(function(i,s,a){let[u,l,d]=zl(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Gr(i.ct,a.mutation)}}(this.serializer,this.userId,e))}};function wr(r){return It(r,"documentOverlays")}var ie=class{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(at(t.integerValue));else if("doubleValue"in t){let n=at(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),xr(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Et(e,20),typeof n=="string"&&(n=oe(n)),e.At(`${n.seconds||""}`),e.dt(n.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Ae(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Ch(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):L()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){let n=t.fields||{};this.Et(e,55);for(let i of Object.keys(n))this.Rt(i,e),this.It(n[i],e)}wt(t,e){let n=t.values||[];this.Et(e,50);for(let i of n)this.It(i,e)}gt(t,e){this.Et(e,37),O.fromName(t).path.forEach(n=>{this.Et(e,60),this.St(n,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}};ie.bt=new ie;function km(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function $l(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=km(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var ca=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ct(n.value),n=e.next();this.vt()}Ft(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Mt(n.value),n=e.next();this.xt()}Ot(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{let i=e.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{let i=e.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(t){let e=this.Bt(t),n=$l(e);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}qt(t){let e=this.Bt(t),n=$l(e);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(t){this.kt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Wt(){return this.buffer.slice(0,this.position)}Bt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Ct(t){let e=255&t;e===0?(this.Kt(0),this.Kt(255)):e===255?(this.Kt(255),this.Kt(0)):this.Kt(e)}Mt(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(t){this.kt(1),this.buffer[this.position++]=t}Ut(t){this.kt(1),this.buffer[this.position++]=~t}kt(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},la=class{constructor(t){this.Gt=t}ft(t){this.Gt.Dt(t)}At(t){this.Gt.Ot(t)}dt(t){this.Gt.Lt(t)}Tt(){this.Gt.Qt()}},ha=class{constructor(t){this.Gt=t}ft(t){this.Gt.Ft(t)}At(t){this.Gt.Nt(t)}dt(t){this.Gt.qt(t)}Tt(){this.Gt.$t()}},Ke=class{constructor(){this.Gt=new ca,this.zt=new la(this.Gt),this.jt=new ha(this.Gt)}seed(t){this.Gt.seed(t)}Ht(t){return t===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var Qe=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}Jt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function ye(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=Wl(r.arrayValue,t.arrayValue),e!==0?e:(e=Wl(r.directionalValue,t.directionalValue),e!==0?e:O.comparator(r.documentKey,t.documentKey)))}function Wl(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var Yi=class{constructor(t){this.Yt=new nt((e,n)=>wt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Zt=t.orderBy,this.Xt=[];for(let e of t.filters){let n=e;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(t){if(q(t.collectionGroup===this.collectionId),this.en)return!1;let e=No(t);if(e!==void 0&&!this.nn(e))return!1;let n=Ge(t),i=new Set,s=0,a=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){let u=this.Yt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let l=n[s];if(!this.rn(u,l)||!this.sn(this.Zt[a++],l))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.Zt.length||!this.sn(this.Zt[a++],u))return!1}return!0}on(){if(this.en)return null;let t=new nt(wt.comparator),e=[];for(let n of this.Xt)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new An(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new An(n.field,0))}for(let n of this.Zt)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new An(n.field,n.dir==="asc"?0:1)));return new Vn(Vn.UNKNOWN_ID,this.collectionId,e,Cr.empty())}nn(t){for(let e of this.Xt)if(this.rn(e,t))return!0;return!1}rn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function gd(r){var t,e;if(q(r instanceof $||r instanceof tt),r instanceof $){if(r instanceof Gi){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>$.create(r.field,"==",s)))||[];return tt.create(i,"or")}return r}let n=r.filters.map(i=>gd(i));return tt.create(n,r.op)}function Mm(r){if(r.getFilters().length===0)return[];let t=ma(gd(r));return q(pd(t)),da(t)||fa(t)?[t]:t.getFilters()}function da(r){return r instanceof $}function fa(r){return r instanceof tt&&Pu(r)}function pd(r){return da(r)||fa(r)||function(e){if(e instanceof tt&&Bo(e)){for(let n of e.getFilters())if(!da(n)&&!fa(n))return!1;return!0}return!1}(r)}function ma(r){if(q(r instanceof $||r instanceof tt),r instanceof $)return r;if(r.filters.length===1)return ma(r.filters[0]);let t=r.filters.map(n=>ma(n)),e=tt.create(t,r.op);return e=Zi(e),pd(e)?e:(q(e instanceof tt),q(Dn(e)),q(e.filters.length>1),e.filters.reduce((n,i)=>Nu(n,i)))}function Nu(r,t){let e;return q(r instanceof $||r instanceof tt),q(t instanceof $||t instanceof tt),e=r instanceof $?t instanceof $?function(i,s){return tt.create([i,s],"and")}(r,t):Hl(r,t):t instanceof $?Hl(t,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),Dn(i)&&Dn(s))return kh(i,s.getFilters());let a=Bo(i)?i:s,u=Bo(i)?s:i,l=a.filters.map(d=>Nu(d,u));return tt.create(l,"or")}(r,t),Zi(e)}function Hl(r,t){if(Dn(t))return kh(t,r.getFilters());{let e=t.filters.map(n=>Nu(r,n));return tt.create(e,"or")}}function Zi(r){if(q(r instanceof $||r instanceof tt),r instanceof $)return r;let t=r.getFilters();if(t.length===1)return Zi(t[0]);if(Dh(r))return r;let e=t.map(i=>Zi(i)),n=[];return e.forEach(i=>{i instanceof $?n.push(i):i instanceof tt&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:tt.create(n,r.op)}var ga=class{constructor(){this._n=new zr}addToCollectionParentIndex(t,e){return this._n.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(Ut.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(Ut.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},zr=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new nt(J.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new nt(J.comparator)).toArray()}};var Ai=new Uint8Array(0),pa=class{constructor(t,e){this.databaseId=e,this.an=new zr,this.un=new Zt(n=>Ye(n),(n,i)=>ti(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.an.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.an.add(e)});let s={collectionId:n,parent:Nt(i)};return Jl(t).put(s)}return S.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[_h(e),""],!1,!0);return Jl(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(Kt(a.parent))}return n})}addFieldIndex(t,e){let n=vr(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=pn(t);return s.next(u=>{a.put(jl(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=vr(t),i=pn(t),s=gn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=vr(t),n=gn(t),i=pn(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return S.forEach(this.cn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new Yi(n).on();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=gn(t),i=!0,s=new Map;return S.forEach(this.cn(e),a=>this.ln(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=K(),u=[];return S.forEach(s,(l,d)=>{C("IndexedDbIndexManager",`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(l)} to execute ${Ye(e)}`);let f=function(B,W){let Z=No(W);if(Z===void 0)return null;for(let Q of ji(B,Z.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(d,l),g=function(B,W){let Z=new Map;for(let Q of Ge(W))for(let v of ji(B,Q.fieldPath))switch(v.op){case"==":case"in":Z.set(Q.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Z.set(Q.fieldPath.canonicalString(),v.value),Array.from(Z.values())}return null}(d,l),w=function(B,W){let Z=[],Q=!0;for(let v of Ge(W)){let p=v.kind===0?Vl(B,v.fieldPath,B.startAt):Cl(B,v.fieldPath,B.startAt);Z.push(p.value),Q&&(Q=p.inclusive)}return new Yt(Z,Q)}(d,l),b=function(B,W){let Z=[],Q=!0;for(let v of Ge(W)){let p=v.kind===0?Cl(B,v.fieldPath,B.endAt):Vl(B,v.fieldPath,B.endAt);Z.push(p.value),Q&&(Q=p.inclusive)}return new Yt(Z,Q)}(d,l),N=this.hn(l,d,w),k=this.hn(l,d,b),D=this.Pn(l,d,g),G=this.In(l.indexId,f,N,w.inclusive,k,b.inclusive,D);return S.forEach(G,z=>n.G(z,e.limit).next(B=>{B.forEach(W=>{let Z=O.fromSegments(W.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return S.resolve(null)})}cn(t){let e=this.un.get(t);return e||(t.filters.length===0?e=[t]:e=Mm(tt.create(t.filters,"and")).map(n=>Jo(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.un.set(t,e),e)}In(t,e,n,i,s,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,s.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){let w=e?this.Tn(e[g/d]):Ai,b=this.En(t,w,n[g%d],i),N=this.dn(t,w,s[g%d],a),k=u.map(D=>this.En(t,w,D,!0));f.push(...this.createRange(b,N,k))}return f}En(t,e,n,i){let s=new Qe(t,O.empty(),e,n);return i?s:s.Jt()}dn(t,e,n,i){let s=new Qe(t,O.empty(),e,n);return i?s.Jt():s}ln(t,e){let n=new Yi(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.tn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.cn(e);return S.forEach(i,s=>this.ln(t,s).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new nt(wt.comparator),f=!1;for(let g of l.filters)for(let w of g.getFlattenedFilters())w.field.isKeyField()||(w.op==="array-contains"||w.op==="array-contains-any"?f=!0:d=d.add(w.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}An(t,e){let n=new Ke;for(let i of Ge(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Ht(i.kind);ie.bt.Pt(s,a)}return n.Wt()}Tn(t){let e=new Ke;return ie.bt.Pt(t,e.Ht(0)),e.Wt()}Rn(t,e){let n=new Ke;return ie.bt.Pt(Je(this.databaseId,e),n.Ht(function(s){let a=Ge(s);return a.length===0?0:a[a.length-1].kind}(t))),n.Wt()}Pn(t,e,n){if(n===null)return[];let i=[];i.push(new Ke);let s=0;for(let a of Ge(t)){let u=n[s++];for(let l of i)if(this.Vn(e,a.fieldPath)&&Mr(u))i=this.mn(i,a,u);else{let d=l.Ht(a.kind);ie.bt.Pt(u,d)}}return this.fn(i)}hn(t,e,n){return this.Pn(t,e,n.position)}fn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Wt();return e}mn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let l=new Ke;l.seed(u.Wt()),ie.bt.Pt(a,l.Ht(e.kind)),s.push(l)}return s}Vn(t,e){return!!t.filters.find(n=>n instanceof $&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=vr(t),i=pn(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return S.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push(function(f,g){let w=g?new Cr(g.sequenceNumber,new Ut(en(g.readTime),new O(Kt(g.documentKey)),g.largestBatchId)):Cr.empty(),b=f.fields.map(([N,k])=>new An(wt.fromServerFormat(N),k));return new Vn(f.indexId,f.collectionGroup,b,w)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:j(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=vr(t),s=pn(t);return this.gn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,l=>s.put(jl(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),S.forEach(u,l=>this.pn(t,i,l).next(d=>{let f=this.yn(s,l);return d.isEqual(f)?S.resolve():this.wn(t,s,l,d,f)}))))})}Sn(t,e,n,i){return gn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,e.key),documentKey:e.key.path.toArray()})}bn(t,e,n,i){return gn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,e.key),e.key.path.toArray()])}pn(t,e,n){let i=gn(t),s=new nt(ye);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,e)])},(a,u)=>{s=s.add(new Qe(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}yn(t,e){let n=new nt(ye),i=this.An(e,t);if(i==null)return n;let s=No(e);if(s!=null){let a=t.data.field(s.fieldPath);if(Mr(a))for(let u of a.arrayValue.values||[])n=n.add(new Qe(e.indexId,t.key,this.Tn(u),i))}else n=n.add(new Qe(e.indexId,t.key,Ai,i));return n}wn(t,e,n,i,s){C("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(l,d,f,g,w){let b=l.getIterator(),N=d.getIterator(),k=mn(b),D=mn(N);for(;k||D;){let G=!1,z=!1;if(k&&D){let B=f(k,D);B<0?z=!0:B>0&&(G=!0)}else k!=null?z=!0:G=!0;G?(g(D),D=mn(N)):z?(w(k),k=mn(b)):(k=mn(b),D=mn(N))}}(i,s,ye,u=>{a.push(this.Sn(t,e,n,u))},u=>{a.push(this.bn(t,e,n,u))}),S.waitFor(a)}gn(t){let e=1;return pn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>ye(a,u)).filter((a,u,l)=>!u||ye(a,l[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=ye(a,t),l=ye(a,e);if(u===0)i[0]=t.Jt();else if(u>0&&l<0)i.push(a),i.push(a.Jt());else if(l>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Dn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Ai,[]],l=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Ai,[]];s.push(IDBKeyRange.bound(u,l))}return s}Dn(t,e){return ye(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Xl)}getMinOffset(t,e){return S.mapArray(this.cn(e),n=>this.ln(t,n).next(i=>i||L())).next(Xl)}};function Jl(r){return It(r,"collectionParents")}function gn(r){return It(r,"indexEntries")}function vr(r){return It(r,"indexConfiguration")}function pn(r){return It(r,"indexState")}function Xl(r){q(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Su(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Ut(t.readTime,t.documentKey,e)}var Yl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qt=class r{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function yd(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.J({range:a},(f,g,w)=>(u++,w.delete()));s.push(l.next(()=>{q(u===1)}));let d=[];for(let f of e.mutations){let g=Ah(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return S.waitFor(s).next(()=>d)}function ts(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L();t=r.noDocument}return JSON.stringify(t).length}qt.DEFAULT_COLLECTION_PERCENTILE=10,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qt.DEFAULT=new qt(41943040,qt.DEFAULT_COLLECTION_PERCENTILE,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qt.DISABLED=new qt(-1,0,0);var es=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(t,e,n,i){q(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _e(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=Tn(t),a=_e(t);return a.add({}).next(u=>{q(typeof u=="number");let l=new Or(u,e,n,i),d=function(b,N,k){let D=k.baseMutations.map(z=>Gr(b.ct,z)),G=k.mutations.map(z=>Gr(b.ct,z));return{userId:N,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:G}}(this.serializer,this.userId,l),f=[],g=new nt((w,b)=>j(w.canonicalString(),b.canonicalString()));for(let w of i){let b=Ah(this.userId,w.key.path,u);g=g.add(w.key.path.popLast()),f.push(a.put(d)),f.push(s.put(b,Gf))}return g.forEach(w=>{f.push(this.indexManager.addToCollectionParentIndex(t,w))}),t.addOnCommittedListener(()=>{this.Cn[u]=l.keys()}),S.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return _e(t).get(e).next(n=>n?(q(n.userId===this.userId),je(this.serializer,n)):null)}vn(t,e){return this.Cn[e]?S.resolve(this.Cn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Cn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return _e(t).J({index:"userMutationsIndex",range:i},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n),s=je(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return _e(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return _e(t).U("userMutationsIndex",e).next(n=>n.map(i=>je(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=Pi(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return Tn(t).J({range:i},(a,u,l)=>{let[d,f,g]=a,w=Kt(f);if(d===this.userId&&e.path.isEqual(w))return _e(t).get(g).next(b=>{if(!b)throw L();q(b.userId===this.userId),s.push(je(this.serializer,b))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(j),i=[];return e.forEach(s=>{let a=Pi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=Tn(t).J({range:u},(d,f,g)=>{let[w,b,N]=d,k=Kt(b);w===this.userId&&s.path.isEqual(k)?n=n.add(N):g.done()});i.push(l)}),S.waitFor(i).next(()=>this.Fn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=Pi(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new nt(j);return Tn(t).J({range:a},(l,d,f)=>{let[g,w,b]=l,N=Kt(w);g===this.userId&&n.isPrefixOf(N)?N.length===i&&(u=u.add(b)):f.done()}).next(()=>this.Fn(t,u))}Fn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(_e(t).get(s).next(a=>{if(a===null)throw L();q(a.userId===this.userId),n.push(je(this.serializer,a))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return yd(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.Mn(e.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Mn(t){delete this.Cn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Tn(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let l=Kt(s[1]);i.push(l)}else u.done()}).next(()=>{q(i.length===0)})})}containsKey(t,e){return _d(t,this.userId,e)}xn(t){return wd(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function _d(r,t,e){let n=Pi(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return Tn(r).J({range:s,H:!0},(u,l,d)=>{let[f,g,w]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function _e(r){return It(r,"mutations")}function Tn(r){return It(r,"documentMutations")}function wd(r){return It(r,"mutationQueues")}var On=class r{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new r(0)}static Ln(){return new r(-1)}};var ya=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Bn(t).next(e=>{let n=new On(e.highestTargetId);return e.highestTargetId=n.next(),this.kn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Bn(t).next(e=>U.fromTimestamp(new lt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Bn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.Bn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.kn(t,i)))}addTargetData(t,e){return this.qn(t,e).next(()=>this.Bn(t).next(n=>(n.targetCount+=1,this.Qn(e,n),this.kn(t,n))))}updateTargetData(t,e){return this.qn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>yn(t).delete(e.targetId)).next(()=>this.Bn(t)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.kn(t,n)))}removeTargets(t,e,n){let i=0,s=[];return yn(t).J((a,u)=>{let l=Ar(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(t,l)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(t,e){return yn(t).J((n,i)=>{let s=Ar(i);e(s)})}Bn(t){return Zl(t).get("targetGlobalKey").next(e=>(q(e!==null),e))}kn(t,e){return Zl(t).put("targetGlobalKey",e)}qn(t,e){return yn(t).put(md(this.serializer,e))}Qn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Bn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=Ye(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return yn(t).J({range:i,index:"queryTargetsIndex"},(a,u,l)=>{let d=Ar(u);ti(e,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=we(t);return e.forEach(a=>{let u=Nt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(i)}removeMatchingKeys(t,e,n){let i=we(t);return S.forEach(e,s=>{let a=Nt(s.path);return S.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=we(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=we(t),s=K();return i.J({range:n,H:!0},(a,u,l)=>{let d=Kt(a[1]),f=new O(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=Nt(e.path),i=IDBKeyRange.bound([n],[_h(n)],!1,!0),s=0;return we(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],l,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(t,e){return yn(t).get(e).next(n=>n?Ar(n):null)}};function yn(r){return It(r,"targets")}function Zl(r){return It(r,"targetGlobal")}function we(r){return It(r,"targetDocuments")}function th([r,t],[e,n]){let i=j(r,e);return i===0?j(t,n):i}var _a=class{constructor(t){this.Kn=t,this.buffer=new nt(th),this.$n=0}Un(){return++this.$n}Wn(t){let e=[t,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();th(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},wa=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(t){C("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Me(e)?C("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield ke(e)}yield this.zn(3e5)}))}},va=class{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.Hn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Ot.oe);let n=new _a(e);return this.jn.forEachTarget(t,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(t,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(C("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Yl)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yl):this.Yn(t,e))}getCacheSize(t){return this.jn.getCacheSize(t)}Yn(t,e){let n,i,s,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),_n()<=jt.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function Fm(r,t){return new va(r,t)}var Ia=class{constructor(t,e){this.db=t,this.garbageCollector=Fm(this,e)}Hn(t){let e=this.Zn(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}Zn(t){let e=0;return this.Jn(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Jn(t,e){return this.Xn(t,(n,i)=>e(i))}addReference(t,e,n){return Si(t,n)}removeReference(t,e,n){return Si(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Si(t,e)}er(t,e){return function(i,s){let a=!1;return wd(i).Y(u=>_d(i,u,s).next(l=>(l&&(a=!0),S.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(t,(a,u)=>{if(u<=e){let l=this.er(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),we(t).delete(function(g){return[0,Nt(g.path)]}(a))))});i.push(l)}}).next(()=>S.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Si(t,e)}Xn(t,e){let n=we(t),i,s=Ot.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:l,sequenceNumber:d})=>{a===0?(s!==Ot.oe&&e(new O(Kt(i)),s),s=d,i=l):s=Ot.oe}).next(()=>{s!==Ot.oe&&e(new O(Kt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Si(r,t){return we(r).put(function(n,i){return{targetId:0,path:Nt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var ns=class{constructor(){this.changes=new Zt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,yt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Ta=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Be(t).put(n)}removeEntry(t,e,n){return Be(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ji(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.tr(t,n)))}getEntry(t,e){let n=yt.newInvalidDocument(e);return Be(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ir(e))},(i,s)=>{n=this.nr(e,s)}).next(()=>n)}rr(t,e){let n={size:0,document:yt.newInvalidDocument(e)};return Be(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ir(e))},(i,s)=>{n={document:this.nr(e,s),size:ts(s)}}).next(()=>n)}getEntries(t,e){let n=Mt();return this.ir(t,e,(i,s)=>{let a=this.nr(i,s);n=n.insert(i,a)}).next(()=>n)}sr(t,e){let n=Mt(),i=new it(O.comparator);return this.ir(t,e,(s,a)=>{let u=this.nr(s,a);n=n.insert(s,u),i=i.insert(s,ts(a))}).next(()=>({documents:n,_r:i}))}ir(t,e,n){if(e.isEmpty())return S.resolve();let i=new nt(rh);e.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Ir(i.first()),Ir(i.last())),a=i.getIterator(),u=a.getNext();return Be(t).J({index:"documentKeyIndex",range:s},(l,d,f)=>{let g=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&rh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(Ir(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Ji(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Be(t).U(IDBKeyRange.bound(u,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Mt();for(let g of d){let w=this.nr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);w.isFoundDocument()&&(ni(e,w)||i.has(w.key))&&(f=f.insert(w.key,w))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Mt(),a=nh(e,n),u=nh(e,Ut.max());return Be(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let g=this.nr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new Ea(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return eh(t).get("remoteDocumentGlobalKey").next(e=>(q(!!e),e))}tr(t,e){return eh(t).put("remoteDocumentGlobalKey",e)}nr(t,e){if(e){let n=Nm(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return yt.newInvalidDocument(t)}};function vd(r){return new Ta(r)}var Ea=class extends ns{constructor(t,e){super(),this.ar=t,this.trackRemovals=e,this.ur=new Zt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new nt((s,a)=>j(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.ur.get(s);if(e.push(this.ar.removeEntry(t,s,u.readTime)),a.isValidDocument()){let l=Gl(this.ar.serializer,a);i=i.add(s.path.popLast());let d=ts(l);n+=d-u.size,e.push(this.ar.addEntry(t,s,l))}else if(n-=u.size,this.trackRemovals){let l=Gl(this.ar.serializer,a.convertToNoDocument(U.min()));e.push(this.ar.addEntry(t,s,l))}}),i.forEach(s=>{e.push(this.ar.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.ar.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.ar.rr(t,e).next(n=>(this.ur.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.ar.sr(t,e).next(({documents:n,_r:i})=>(i.forEach((s,a)=>{this.ur.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function eh(r){return It(r,"remoteDocumentGlobal")}function Be(r){return It(r,"remoteDocumentsV14")}function Ir(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function nh(r,t){let e=t.documentKey.path.toArray();return[r,Ji(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function rh(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=j(e[s],n[s]),i)return i;return i=j(e.length,n.length),i||(i=j(e[e.length-2],n[n.length-2]),i||j(e[e.length-1],n[n.length-1]))}var Aa=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var rs=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&Rr(n.mutation,i,Lt.empty(),lt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let i=Qt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=Er();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Qt();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Mt(),a=br(),u=function(){return br()}();return e.forEach((l,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof zt)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Rr(f.mutation,d,f.mutation.getFieldMask(),lt.now())):a.set(d.key,Lt.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new Aa(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=br(),i=new it((a,u)=>a-u),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||Lt.empty();f=u.applyToLocalView(d,f),n.set(l,f);let g=(i.get(u.batchId)||K()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,g=zh();f.forEach(w=>{if(!s.has(w)){let b=Xh(e.get(w),n.get(w));b!==null&&g.set(w,b),s=s.add(w)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Vu(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):S.resolve(Qt()),u=-1,l=s;return a.next(d=>S.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(t,f).next(w=>{l=l.insert(f,w)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,l,d,K())).next(f=>({batchId:u,changes:Gh(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next(n=>{let i=Er();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=Er();return this.indexManager.getCollectionParents(t,s).next(u=>S.forEach(u,l=>{let d=function(g,w){return new Gt(w,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,w)=>{a=a.insert(g,w)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,yt.newInvalidDocument(f)))});let u=Er();return a.forEach((l,d)=>{let f=s.get(l);f!==void 0&&Rr(f.mutation,d,Lt.empty(),lt.now()),ni(e,d)&&(u=u.insert(l,d))}),u})}};var Sa=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return S.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:ht(i.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(i){return{name:i.name,query:Du(i.bundledQuery),readTime:ht(i.readTime)}}(e)),S.resolve()}};var ba=class{constructor(){this.overlays=new it(O.comparator),this.hr=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Qt();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.ht(t,e,s)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.hr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let i=Qt(),s=e.length+1,a=new O(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return S.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new it((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Qt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Qt(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return S.resolve(u)}ht(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Lr(e,n));let s=this.hr.get(e);s===void 0&&(s=K(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}};var jr=class{constructor(){this.Pr=new nt(mt.Ir),this.Tr=new nt(mt.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){let n=new mt(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Ar(new mt(t,e))}Rr(t,e){t.forEach(n=>this.removeReference(n,e))}Vr(t){let e=new O(new J([])),n=new mt(e,t),i=new mt(e,t+1),s=[];return this.Tr.forEachInRange([n,i],a=>{this.Ar(a),s.push(a.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let e=new O(new J([])),n=new mt(e,t),i=new mt(e,t+1),s=K();return this.Tr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new mt(t,0),n=this.Pr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},mt=class{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return O.comparator(t.key,e.key)||j(t.pr,e.pr)}static Er(t,e){return j(t.pr,e.pr)||O.comparator(t.key,e.key)}};var Ra=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new nt(mt.Ir)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Or(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.wr=this.wr.add(new mt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.br(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new mt(e,0),i=new mt(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],a=>{let u=this.Sr(a.pr);s.push(u)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(j);return e.forEach(i=>{let s=new mt(i,0),a=new mt(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,a],u=>{n=n.add(u.pr)})}),S.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;O.isDocumentKey(s)||(s=s.child(""));let a=new mt(new O(s),0),u=new nt(j);return this.wr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.pr)),!0)},a),S.resolve(this.Dr(u))}Dr(t){let e=[];return t.forEach(n=>{let i=this.Sr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.Cr(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.wr;return S.forEach(e.mutations,i=>{let s=new mt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.wr=n})}Mn(t){}containsKey(t,e){let n=new mt(e,0),i=this.wr.firstAfterOrEqual(n);return S.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Cr(t,e){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Pa=class{constructor(t){this.vr=t,this.docs=function(){return new it(O.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():yt.newInvalidDocument(e))}getEntries(t,e){let n=Mt();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():yt.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Mt(),a=e.path,u=new O(a.child("")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Su(vh(f),n)<=0||(i.has(f.key)||ni(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L()}Fr(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Va(this)}getSize(t){return S.resolve(this.size)}},Va=class extends ns{constructor(t){super(),this.ar=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.ar.addEntry(t,i)):this.ar.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}};var Ca=class{constructor(t){this.persistence=t,this.Mr=new Zt(e=>Ye(e),ti),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.Or=0,this.Nr=new jr,this.targetCount=0,this.Lr=On.Nn()}forEachTarget(t,e){return this.Mr.forEach((n,i)=>e(i)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),S.resolve()}qn(t){this.Mr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Lr=new On(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.qn(e),S.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Mr.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Mr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Mr.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),S.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.Nr.gr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.Nr.containsKey(e))}};var is=class{constructor(t,e){this.Br={},this.overlays={},this.kr=new Ot(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Ca(this),this.indexManager=new ga,this.remoteDocumentCache=function(i){return new Pa(i)}(n=>this.referenceDelegate.Kr(n)),this.serializer=new Hi(e),this.$r=new Sa(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new ba,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Ra(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){C("MemoryPersistence","Starting transaction:",t);let i=new xa(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(t,e){return S.or(Object.values(this.Br).map(n=>()=>n.containsKey(t,e)))}},xa=class extends Oi{constructor(t){super(),this.currentSequenceNumber=t}},ss=class r{constructor(t){this.persistence=t,this.zr=new jr,this.jr=null}static Hr(t){return new r(t)}get Jr(){if(this.jr)return this.jr;throw L()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),S.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(i=>this.Jr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.Jr,n=>{let i=O.fromPath(n);return this.Yr(t,i).next(s=>{s||e.removeEntry(i,U.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(n=>{n?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return S.or([()=>S.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}};var Da=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new Li("createOrUpgrade",e);n<1&&i>=1&&(function(l){l.createObjectStore("owner")}(t),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",vl,{unique:!0}),l.createObjectStore("documentMutations")}(t),ih(t),function(l){l.createObjectStore("remoteDocuments")}(t));let a=S.resolve();return n<3&&i>=3&&(n!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(t),ih(t)),a=a.next(()=>function(l){let d=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store("mutations").U().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",vl,{unique:!0});let g=d.store("mutations"),w=f.map(b=>g.put(b));return S.waitFor(w)})}(t,s))),a=a.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.Xr(s))),n<6&&i>=6&&(a=a.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(t),this.ei(s)))),n<7&&i>=7&&(a=a.next(()=>this.ti(s))),n<8&&i>=8&&(a=a.next(()=>this.ni(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.ri(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore("documentOverlays",{keyPath:tm});d.createIndex("collectionPathOverlayIndex",em,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",nm,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore("remoteDocumentsV14",{keyPath:zf});d.createIndex("documentKeyIndex",jf),d.createIndex("collectionGroupIndex",Kf)}(t)).next(()=>this.ii(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.si(t,s))),n<15&&i>=15&&(a=a.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:Jf}).createIndex("sequenceNumberIndex",Xf,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:Yf}).createIndex("documentKeyIndex",Zf,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),a}ei(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=ts(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>S.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>S.forEach(u,l=>{q(l.userId===s.userId);let d=je(this.serializer,l);return yd(t,s.userId,d).next(()=>{})}))}))}ti(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let l=new J(a),d=function(g){return[0,Nt(g)]}(l);s.push(e.get(d).next(f=>f?S.resolve():(g=>e.put({targetId:0,path:Nt(g),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>S.waitFor(s))})}ni(t,e){t.createObjectStore("collectionParents",{keyPath:Hf});let n=e.store("collectionParents"),i=new zr,s=a=>{if(i.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:Nt(l)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let l=new J(a);return s(l.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,l],d)=>{let f=Kt(u);return s(f.popLast())}))}ri(t){let e=t.store("targets");return e.J((n,i)=>{let s=Ar(i),a=md(this.serializer,s);return e.put(a)})}ii(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),l=function(g){return g.document?new O(J.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L()}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>S.waitFor(i))}si(t,e){let n=e.store("mutations"),i=vd(this.serializer),s=new is(ss.Hr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:K();je(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),S.forEach(u,(l,d)=>{let f=new gt(d),g=Xi.lt(this.serializer,f),w=s.getIndexManager(f),b=es.lt(f,this.serializer,w,s.referenceDelegate);return new rs(i,b,g,w).recalculateAndSaveOverlaysForDocumentKeys(new Dr(e,Ot.oe),l).next()})})}};function ih(r){r.createObjectStore("targetDocuments",{keyPath:$f}).createIndex("documentTargetsIndex",Wf,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Qf,{unique:!0}),r.createObjectStore("targetGlobal")}var Eo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Na=class r{constructor(t,e,n,i,s,a,u,l,d,f,g=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.oi=s,this.window=a,this.document=u,this._i=d,this.ai=f,this.ui=g,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=w=>Promise.resolve(),!r.D())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ia(this,i),this.Ti=e+"main",this.serializer=new Hi(l),this.Ei=new Ee(this.Ti,this.ui,new Da(this.serializer)),this.Qr=new ya(this.referenceDelegate,this.serializer),this.remoteDocumentCache=vd(this.serializer),this.$r=new ua,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,f===!1&&ct("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Eo);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qr.getHighestSequenceNumber(t))}).then(t=>{this.kr=new Ot(t,this._i)}).then(()=>{this.qr=!0}).catch(t=>(this.Ei&&this.Ei.close(),Promise.reject(t)))}fi(t){return this.Ii=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ei.L(e=>V(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.oi.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>bi(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(t).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(t)).next(e=>this.isPrimary&&!e?this.yi(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(Me(t))return C("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return C("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.oi.enqueueRetryable(()=>this.Ii(t)),this.isPrimary=t})}gi(t){return Tr(t).get("owner").next(e=>S.resolve(this.Si(e)))}bi(t){return bi(t).delete(this.clientId)}Di(){return V(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=It(e,"clientMetadata");return n.U().next(i=>{let s=this.vi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.di)for(let e of t)this.di.removeItem(this.Fi(e.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(t){return!!t&&t.ownerId===this.clientId}pi(t){return this.ai?S.resolve(!0):Tr(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)){if(this.Si(e)&&this.networkEnabled)return!0;if(!this.Si(e)){if(!e.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Eo);return!1}}return!(!this.networkEnabled||!this.inForeground)||bi(t).U().next(n=>this.vi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&C("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Dr(t,Ot.oe);return this.yi(e).next(()=>this.bi(e))}),this.Ei.close(),this.Li()})}vi(t,e){return t.filter(n=>this.Ci(n.updateTimeMs,e)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",t=>bi(t).U().next(e=>this.vi(e,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(t,e){return es.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new pa(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return Xi.lt(this.serializer,t)}getBundleCache(){return this.$r}runTransaction(t,e,n){C("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(l){return l===16?im:l===15?Ph:l===14?Rh:l===13?bh:l===12?rm:l===11?Sh:void L()}(this.ui),a;return this.Ei.runTransaction(t,i,s,u=>(a=new Dr(u,this.kr?this.kr.next():Ot.oe),e==="readwrite-primary"?this.gi(a).next(l=>!!l||this.pi(a)).next(l=>{if(!l)throw ct(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new x(P.FAILED_PRECONDITION,Ih);return n(a)}).next(l=>this.wi(a).next(()=>l)):this.ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ki(t){return Tr(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,Eo)})}wi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Tr(t).put("owner",e)}static D(){return Ee.D()}yi(t){let e=Tr(t);return e.get("owner").next(n=>this.Si(n)?(C("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):S.resolve())}Ci(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ct(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;ho()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(t){var e;try{let n=((e=this.di)===null||e===void 0?void 0:e.getItem(this.Fi(t)))!==null;return C("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ct("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(t){ct("Failed to set zombie client id.",t)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Tr(r){return It(r,"owner")}function bi(r){return It(r,"clientMetadata")}function ku(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var ka=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=i}static Ki(t,e){let n=K(),i=K();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var Ma=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var os=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return ho()?8:Th(yr())>0?6:4}()}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.ji(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Hi(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Ma;return this.Ji(t,e,a).next(u=>{if(s.result=u,this.Ui)return this.Yi(t,e,a,u.size)})}).next(()=>s.result)}Yi(t,e,n,i){return n.documentReadCount<this.Wi?(_n()<=jt.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",wn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),S.resolve()):(_n()<=jt.DEBUG&&C("QueryEngine","Query:",wn(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(_n()<=jt.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",wn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):S.resolve())}ji(t,e){if(xl(e))return S.resolve(null);let n=kt(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Ki(e,null,"F"),n=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=K(...s);return this.zi.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.Zi(e,u);return this.Xi(e,d,a,l.readTime)?this.ji(t,Ki(e,null,"F")):this.es(t,d,e,l)}))})))}Hi(t,e,n,i){return xl(e)||i.isEqual(U.min())?S.resolve(null):this.zi.getDocuments(t,n).next(s=>{let a=this.Zi(e,s);return this.Xi(e,a,n,i)?S.resolve(null):(_n()<=jt.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),wn(e)),this.es(t,a,e,wh(i,-1)).next(u=>u))})}Zi(t,e){let n=new nt(Uh(t));return e.forEach((i,s)=>{ni(t,s)&&(n=n.add(s))}),n}Xi(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(t,e,n){return _n()<=jt.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",wn(e)),this.zi.getDocumentsMatchingQuery(t,e,Ut.min(),n)}es(t,e,n,i){return this.zi.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Fa=class{constructor(t,e,n,i){this.persistence=t,this.ts=e,this.serializer=i,this.ns=new it(j),this.rs=new Zt(s=>Ye(s),ti),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new rs(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}};function Id(r,t,e,n){return new Fa(r,t,e,n)}function Td(r,t){return V(this,null,function*(){let e=F(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e._s(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],l=K();for(let d of i){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({us:d,removedBatchIds:a,addedBatchIds:u}))})})})}function Om(r,t){let e=F(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.os.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){let g=d.batch,w=g.keys(),b=S.resolve();return w.forEach(N=>{b=b.next(()=>f.getEntry(l,N)).next(k=>{let D=d.docVersions.get(N);q(D!==null),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),b.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function Ed(r){let t=F(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Lm(r,t){let e=F(r),n=t.snapshotVersion,i=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.os.newChangeBuffer({trackRemovals:!0});i=e.ns;let u=[];t.targetChanges.forEach((f,g)=>{let w=i.get(g);if(!w)return;u.push(e.Qr.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.Qr.addMatchingKeys(s,f.addedDocuments,g)));let b=w.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?b=b.withResumeToken(vt.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,n)),i=i.insert(g,b),function(k,D,G){return k.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(w,b,f)&&u.push(e.Qr.updateTargetData(s,b))});let l=Mt(),d=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Ad(s,a,t.documentUpdates).next(f=>{l=f.cs,d=f.ls})),!n.isEqual(U.min())){let f=e.Qr.getLastRemoteSnapshotVersion(s).next(g=>e.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(e.ns=i,s))}function Ad(r,t,e){let n=K(),i=K();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Mt();return e.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):C("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{cs:a,ls:i}})}function qm(r,t){let e=F(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Ln(r,t){let e=F(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Qr.getTargetData(n,t).next(s=>s?(i=s,S.resolve(i)):e.Qr.allocateTargetId(n).next(a=>(i=new Fn(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.ns.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ns=e.ns.insert(n.targetId,n),e.rs.set(t,n.targetId)),n})}function qn(r,t,e){return V(this,null,function*(){let n=F(r),i=n.ns.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Me(a))throw a;C("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.ns=n.ns.remove(t),n.rs.delete(i.target)})}function as(r,t,e){let n=F(r),i=U.min(),s=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,f){let g=F(l),w=g.rs.get(f);return w!==void 0?S.resolve(g.ns.get(w)):g.Qr.getTargetData(d,f)}(n,a,kt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.ts.getDocumentsMatchingQuery(a,t,e?i:U.min(),e?s:K())).next(u=>(Rd(n,qh(t),u),{documents:u,hs:s})))}function Sd(r,t){let e=F(r),n=F(e.Qr),i=e.ns.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,t).next(a=>a?a.target:null))}function bd(r,t){let e=F(r),n=e.ss.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.os.getAllFromCollectionGroup(i,t,wh(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Rd(e,t,i),i))}function Rd(r,t,e){let n=r.ss.get(t)||U.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(t,n)}function Um(r,t,e,n){return V(this,null,function*(){let i=F(r),s=K(),a=Mt();for(let d of e){let f=t.Ps(d.metadata.name);d.document&&(s=s.add(f));let g=t.Is(d);g.setReadTime(t.Ts(d.metadata.readTime)),a=a.insert(f,g)}let u=i.os.newChangeBuffer({trackRemovals:!0}),l=yield Ln(i,function(f){return kt($n(J.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>Ad(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.Qr.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.cs,f.ls)).next(()=>f.cs)))})}function Bm(n,i){return V(this,arguments,function*(r,t,e=K()){let s=yield Ln(r,kt(Du(t.bundledQuery))),a=F(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let l=ht(t.readTime);if(s.snapshotVersion.compareTo(l)>=0)return a.$r.saveNamedQuery(u,t);let d=s.withResumeToken(vt.EMPTY_BYTE_STRING,l);return a.ns=a.ns.insert(d.targetId,d),a.Qr.updateTargetData(u,d).next(()=>a.Qr.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Qr.addMatchingKeys(u,e,s.targetId)).next(()=>a.$r.saveNamedQuery(u,t))})})}function sh(r,t){return`firestore_clients_${r}_${t}`}function oh(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function Ao(r,t){return`firestore_targets_${r}_${t}`}var us=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Es(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new x(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(ct("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Pr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Es(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new x(n.error.code,n.error.message))),s?new r(t,n.state,i):(ct("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},cs=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Es(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Cu();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Eh(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(ct("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Oa=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Es(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ct("SharedClientState",`Failed to parse online state: ${t}`),null)}},Kr=class{constructor(){this.activeTargetIds=Cu()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Vr=class{constructor(t,e,n,i,s){this.window=t,this.oi=e,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new it(j),this.started=!1,this.ys=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=sh(this.persistenceKey,this.Vs),this.Ss=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Kr),this.bs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Fs=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.Bi();for(let n of t){if(n===this.Vs)continue;let i=this.getItem(sh(this.persistenceKey,n));if(i){let s=cs.Es(n,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let n=this.xs(e);n&&this.Os(n)}for(let n of this.ys)this.gs(n);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Ss,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(t){let e=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ls(t,"pending")}updateMutationState(t,e,n){this.Ls(t,e,n),this.Bs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let n=this.storage.getItem(Ao(this.persistenceKey,t));if(n){let i=Pr.Es(t,n);i&&(e=i.state)}}return this.ks.As(t),this.Ms(),e}removeLocalQueryTarget(t){this.ks.Rs(t),this.Ms()}isLocalQueryTarget(t){return this.ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Ao(this.persistenceKey,t))}updateQueryState(t,e,n){this.qs(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.Bs(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Qs(t)}notifyBundleLoaded(t){this.Ks(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return C("SharedClientState","READ",t,e),e}setItem(t,e){C("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){C("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gs(t){let e=t;if(e.storageArea===this.storage){if(C("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void ct("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.bs.test(e.key)){if(e.newValue==null){let n=this.$s(e.key);return this.Us(n,null)}{let n=this.Ws(e.key,e.newValue);if(n)return this.Us(n.clientId,n)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let n=this.Gs(e.key,e.newValue);if(n)return this.zs(n)}}else if(this.Cs.test(e.key)){if(e.newValue!==null){let n=this.js(e.key,e.newValue);if(n)return this.Hs(n)}}else if(e.key===this.vs){if(e.newValue!==null){let n=this.xs(e.newValue);if(n)return this.Os(n)}}else if(e.key===this.Ss){let n=function(s){let a=Ot.oe;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number"),a=u}catch(u){ct("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Ot.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Fs){let n=this.Js(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(e)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(t,e,n){let i=new us(this.currentUser,t,e,n),s=oh(this.persistenceKey,this.currentUser,t);this.setItem(s,i.ds())}Bs(t){let e=oh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Qs(t){let e={clientId:this.Vs,onlineState:t};this.storage.setItem(this.vs,JSON.stringify(e))}qs(t,e,n){let i=Ao(this.persistenceKey,t),s=new Pr(t,e,n);this.setItem(i,s.ds())}Ks(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Fs,e)}$s(t){let e=this.bs.exec(t);return e?e[1]:null}Ws(t,e){let n=this.$s(t);return cs.Es(n,e)}Gs(t,e){let n=this.Ds.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return us.Es(new gt(s),i,e)}js(t,e){let n=this.Cs.exec(t),i=Number(n[1]);return Pr.Es(i,e)}xs(t){return Oa.Es(t)}Js(t){return JSON.parse(t)}zs(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Zs(t.batchId,t.state,t.error);C("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Hs(t){return this.syncEngine.Xs(t.targetId,t.state,t.error)}Us(t,e){let n=e?this.ps.insert(t,e):this.ps.remove(t),i=this.Ns(this.ps),s=this.Ns(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.eo(a,u).then(()=>{this.ps=n})}Os(t){this.ps.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ns(t){let e=Cu();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},ls=class{constructor(){this.no=new Kr,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Kr,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var La=class{io(t){}shutdown(){}};var hs=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){C("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){C("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ri=null;function So(){return Ri===null?Ri=function(){return 268435456+Math.round(2147483648*Math.random())}():Ri++,"0x"+Ri.toString(16)}var Gm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var qa=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}Ao(t){this.Ro=t}onMessage(t){this.Vo=t}close(){this.ho()}send(t){this.lo(t)}mo(){this.Io()}fo(){this.Eo()}po(t){this.Ro(t)}yo(t){this.Vo(t)}};var Vt="WebChannelConnection",Ua=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+e.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(e,n,i,s,a){let u=So(),l=this.vo(e,n.toUriEncodedString());C("RestConnection",`Sending RPC '${e}' ${u}:`,l,i);let d={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(d,s,a),this.Mo(e,l,d,i).then(f=>(C("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw Jt("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",l,"request:",i),f})}xo(e,n,i,s,a,u){return this.Co(e,n,i,s,a)}Fo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Qn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}vo(e,n){let i=Gm[e];return`${this.wo}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Mo(t,e,n,i){let s=So();return new Promise((a,u)=>{let l=new po;l.setWithCredentials(!0),l.listenOnce(_o.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case _r.NO_ERROR:let f=l.getResponseJson();C(Vt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case _r.TIMEOUT:C(Vt,`RPC '${t}' ${s} timed out`),u(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case _r.HTTP_ERROR:let g=l.getStatus();if(C(Vt,`RPC '${t}' ${s} failed with status:`,g,"response text:",l.getResponseText()),g>0){let w=l.getResponseJson();Array.isArray(w)&&(w=w[0]);let b=w?.error;if(b&&b.status&&b.message){let N=function(D){let G=D.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(G)>=0?G:P.UNKNOWN}(b.status);u(new x(N,b.message))}else u(new x(P.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new x(P.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{C(Vt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);C(Vt,`RPC '${t}' ${s} sending request:`,i),l.send(e,"POST",d,n,15)})}Oo(t,e,n){let i=So(),s=[this.wo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Io(),u=vo(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.xmlHttpFactory=new yo({})),this.Fo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=s.join("");C(Vt,`Creating RPC '${t}' stream ${i}: ${f}`,l);let g=a.createWebChannel(f,l),w=!1,b=!1,N=new qa({lo:D=>{b?C(Vt,`Not sending because RPC '${t}' stream ${i} is closed:`,D):(w||(C(Vt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),w=!0),C(Vt,`RPC '${t}' stream ${i} sending:`,D),g.send(D))},ho:()=>g.close()}),k=(D,G,z)=>{D.listen(G,B=>{try{z(B)}catch(W){setTimeout(()=>{throw W},0)}})};return k(g,fn.EventType.OPEN,()=>{b||(C(Vt,`RPC '${t}' stream ${i} transport opened.`),N.mo())}),k(g,fn.EventType.CLOSE,()=>{b||(b=!0,C(Vt,`RPC '${t}' stream ${i} transport closed`),N.po())}),k(g,fn.EventType.ERROR,D=>{b||(b=!0,Jt(Vt,`RPC '${t}' stream ${i} transport errored:`,D),N.po(new x(P.UNAVAILABLE,"The operation could not be completed")))}),k(g,fn.EventType.MESSAGE,D=>{var G;if(!b){let z=D.data[0];q(!!z);let B=z,W=B.error||((G=B[0])===null||G===void 0?void 0:G.error);if(W){C(Vt,`RPC '${t}' stream ${i} received error:`,W);let Z=W.status,Q=function(_){let I=ft[_];if(I!==void 0)return td(I)}(Z),v=W.message;Q===void 0&&(Q=P.INTERNAL,v="Unknown error status: "+Z+" with message "+W.message),b=!0,N.po(new x(Q,v)),g.close()}else C(Vt,`RPC '${t}' stream ${i} received:`,z),N.yo(z)}}),k(u,wo.STAT_EVENT,D=>{D.stat===Ei.PROXY?C(Vt,`RPC '${t}' stream ${i} detected buffering proxy`):D.stat===Ei.NOPROXY&&C(Vt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.fo()},0),N}};function Pd(){return typeof window<"u"?window:null}function Di(){return typeof document<"u"?document:null}function ri(r){return new ra(r,!0)}var Qr=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.oi=t,this.timerId=e,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(t){this.cancel();let e=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,e-n);i>0&&C("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),t())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var ds=class{constructor(t,e,n,i,s,a,u,l){this.oi=t,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Qr(t,e)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return V(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(t){this.s_(),this.stream.send(t)}r_(){return V(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(t,e){return V(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,t!==4?this.Yo.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(ct(e.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Ao(e)})}__(){}auth(){this.state=1;let t=this.a_(this.jo),e=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===e&&this.u_(n,i)},n=>{t(()=>{let i=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(t,e){let n=this.a_(this.jo);this.stream=this.l_(t,e),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>V(this,null,function*(){this.state=0,this.start()}))}c_(t){return C("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}a_(t){return e=>{this.oi.enqueueAndForget(()=>this.jo===t?e():(C("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ba=class extends ds{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}l_(t,e){return this.connection.Oo("Listen",t,e)}onMessage(t){this.Yo.reset();let e=bm(this.serializer,t),n=function(s){if(!("targetChange"in s))return U.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?ht(a.readTime):U.min()}(t);return this.listener.h_(e,n)}P_(t){let e={};e.database=oa(this.serializer),e.addTarget=function(s,a){let u,l=a.target;if(u=zi(l)?{documents:ud(s,l)}:{query:cd(s,l)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=nd(s,a.resumeToken);let d=ia(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=Mn(s,a.snapshotVersion.toTimestamp());let d=ia(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=Pm(this.serializer,t);n&&(e.labels=n),this.i_(e)}I_(t){let e={};e.database=oa(this.serializer),e.removeTarget=t,this.i_(e)}},Ga=class extends ds{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(t,e){return this.connection.Oo("Write",t,e)}onMessage(t){if(q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.T_){this.Yo.reset();let e=Rm(t.writeResults,t.commitTime),n=ht(t.commitTime);return this.listener.A_(n,e)}return q(!t.writeResults||t.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let t={};t.database=oa(this.serializer),this.i_(t)}d_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Gr(this.serializer,n))};this.i_(e)}};var za=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Co(t,e,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(t,sa(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(P.UNKNOWN,s.toString())})}xo(t,e,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.xo(t,sa(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},ja=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(t){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,t==="Online"&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ct(e),this.y_=!1):C("OnlineStateTracker",e)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var Ka=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(a=>{n.enqueueAndForget(()=>V(this,null,function*(){Fe(this)&&(C("RemoteStore","Restarting streams for network reachability change."),yield function(l){return V(this,null,function*(){let d=F(l);d.M_.add(4),yield Wn(d),d.N_.set("Unknown"),d.M_.delete(4),yield ii(d)})}(this))}))}),this.N_=new ja(n,i)}};function ii(r){return V(this,null,function*(){if(Fe(r))for(let t of r.x_)yield t(!0)})}function Wn(r){return V(this,null,function*(){for(let t of r.x_)yield t(!1)})}function xs(r,t){let e=F(r);e.F_.has(t.targetId)||(e.F_.set(t.targetId,t),Ou(e)?Fu(e):Jn(e).Xo()&&Mu(e,t))}function Un(r,t){let e=F(r),n=Jn(e);e.F_.delete(t),n.Xo()&&Vd(e,t),e.F_.size===0&&(n.Xo()?n.n_():Fe(e)&&e.N_.set("Unknown"))}function Mu(r,t){if(r.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Jn(r).P_(t)}function Vd(r,t){r.L_.xe(t),Jn(r).I_(t)}function Fu(r){r.L_=new na({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.F_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),Jn(r).start(),r.N_.w_()}function Ou(r){return Fe(r)&&!Jn(r).Zo()&&r.F_.size>0}function Fe(r){return F(r).M_.size===0}function Cd(r){r.L_=void 0}function zm(r){return V(this,null,function*(){r.N_.set("Online")})}function jm(r){return V(this,null,function*(){r.F_.forEach((t,e)=>{Mu(r,t)})})}function Km(r,t){return V(this,null,function*(){Cd(r),Ou(r)?(r.N_.D_(t),Fu(r)):r.N_.set("Unknown")})}function Qm(r,t,e){return V(this,null,function*(){if(r.N_.set("Online"),t instanceof $i&&t.state===2&&t.cause)try{yield function(i,s){return V(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.F_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.F_.delete(u),i.L_.removeTarget(u))})}(r,t)}catch(n){C("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield fs(r,n)}else if(t instanceof bn?r.L_.Ke(t):t instanceof Qi?r.L_.He(t):r.L_.We(t),!e.isEqual(U.min()))try{let n=yield Ed(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.L_.rt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.F_.get(d);f&&s.F_.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=s.F_.get(l);if(!f)return;s.F_.set(l,f.withResumeToken(vt.EMPTY_BYTE_STRING,f.snapshotVersion)),Vd(s,l);let g=new Fn(f.target,l,d,f.sequenceNumber);Mu(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){C("RemoteStore","Failed to raise snapshot:",n),yield fs(r,n)}})}function fs(r,t,e){return V(this,null,function*(){if(!Me(t))throw t;r.M_.add(1),yield Wn(r),r.N_.set("Offline"),e||(e=()=>Ed(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(this,null,function*(){C("RemoteStore","Retrying IndexedDB access"),yield e(),r.M_.delete(1),yield ii(r)}))})}function xd(r,t){return t().catch(e=>fs(r,e,t))}function Hn(r){return V(this,null,function*(){let t=F(r),e=Ce(t),n=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;$m(t);)try{let i=yield qm(t.localStore,n);if(i===null){t.v_.length===0&&e.n_();break}n=i.batchId,Wm(t,i)}catch(i){yield fs(t,i)}Dd(t)&&Nd(t)})}function $m(r){return Fe(r)&&r.v_.length<10}function Wm(r,t){r.v_.push(t);let e=Ce(r);e.Xo()&&e.E_&&e.d_(t.mutations)}function Dd(r){return Fe(r)&&!Ce(r).Zo()&&r.v_.length>0}function Nd(r){Ce(r).start()}function Hm(r){return V(this,null,function*(){Ce(r).V_()})}function Jm(r){return V(this,null,function*(){let t=Ce(r);for(let e of r.v_)t.d_(e.mutations)})}function Xm(r,t,e){return V(this,null,function*(){let n=r.v_.shift(),i=Zo.from(n,t,e);yield xd(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Hn(r)})}function Ym(r,t){return V(this,null,function*(){t&&Ce(r).E_&&(yield function(n,i){return V(this,null,function*(){if(function(a){return Zh(a)&&a!==P.ABORTED}(i.code)){let s=n.v_.shift();Ce(n).t_(),yield xd(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Hn(n)}})}(r,t)),Dd(r)&&Nd(r)})}function ah(r,t){return V(this,null,function*(){let e=F(r);e.asyncQueue.verifyOperationInProgress(),C("RemoteStore","RemoteStore received new credentials");let n=Fe(e);e.M_.add(3),yield Wn(e),n&&e.N_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.M_.delete(3),yield ii(e)})}function Qa(r,t){return V(this,null,function*(){let e=F(r);t?(e.M_.delete(2),yield ii(e)):t||(e.M_.add(2),yield Wn(e),e.N_.set("Unknown"))})}function Jn(r){return r.B_||(r.B_=function(e,n,i){let s=F(e);return s.f_(),new Ba(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:zm.bind(null,r),To:jm.bind(null,r),Ao:Km.bind(null,r),h_:Qm.bind(null,r)}),r.x_.push(t=>V(this,null,function*(){t?(r.B_.t_(),Ou(r)?Fu(r):r.N_.set("Unknown")):(yield r.B_.stop(),Cd(r))}))),r.B_}function Ce(r){return r.k_||(r.k_=function(e,n,i){let s=F(e);return s.f_(),new Ga(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:Hm.bind(null,r),Ao:Ym.bind(null,r),R_:Jm.bind(null,r),A_:Xm.bind(null,r)}),r.x_.push(t=>V(this,null,function*(){t?(r.k_.t_(),yield Hn(r)):(yield r.k_.stop(),r.v_.length>0&&(C("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))}))),r.k_}var $a=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new pt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Xn(r,t){if(ct("AsyncQueue",`${t}: ${r}`),Me(r))return new x(P.UNAVAILABLE,`${t}: ${r}`);throw r}var ms=class r{constructor(t){this.comparator=t?(e,n)=>t(e,n)||O.comparator(e.key,n.key):(e,n)=>O.comparator(e.key,n.key),this.keyedMap=Er(),this.sortedSet=new it(this.comparator)}static emptySet(t){return new r(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var gs=class{constructor(){this.q_=new it(O.comparator)}track(t){let e=t.doc.key,n=this.q_.get(e);n?t.type!==0&&n.type===3?this.q_=this.q_.insert(e,t):t.type===3&&n.type!==1?this.q_=this.q_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.q_=this.q_.remove(e):t.type===1&&n.type===2?this.q_=this.q_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):L():this.q_=this.q_.insert(e,t)}Q_(){let t=[];return this.q_.inorderTraversal((e,n)=>{t.push(n)}),t}},Bn=class r{constructor(t,e,n,i,s,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,ms.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ei(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var Wa=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(t=>t.G_())}},Ha=class{constructor(){this.queries=new Zt(t=>Lh(t),ei),this.onlineState="Unknown",this.z_=new Set}};function Lu(r,t){return V(this,null,function*(){let e=F(r),n=3,i=t.query,s=e.queries.get(i);s?!s.W_()&&t.G_()&&(n=2):(s=new Wa,n=t.G_()?0:1);try{switch(n){case 0:s.K_=yield e.onListen(i,!0);break;case 1:s.K_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=Xn(a,`Initialization of query '${wn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.U_.push(t),t.j_(e.onlineState),s.K_&&t.H_(s.K_)&&Uu(e)})}function qu(r,t){return V(this,null,function*(){let e=F(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.U_.indexOf(t);a>=0&&(s.U_.splice(a,1),s.U_.length===0?i=t.G_()?0:1:!s.W_()&&t.G_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function Zm(r,t){let e=F(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.U_)u.H_(i)&&(n=!0);a.K_=i}}n&&Uu(e)}function tg(r,t,e){let n=F(r),i=n.queries.get(t);if(i)for(let s of i.U_)s.onError(e);n.queries.delete(t)}function Uu(r){r.z_.forEach(t=>{t.next()})}var Ja,uh;(uh=Ja||(Ja={})).J_="default",uh.Cache="cache";var $r=class{constructor(t,e,n){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new Bn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache||!this.G_())return!0;let n=e!=="Offline";return(!this.options.ra||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ea(t){if(t.docChanges.length>0)return!0;let e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}na(t){t=Bn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==Ja.Cache}};var Xa=class{constructor(t,e){this.ia=t,this.byteLength=e}sa(){return"metadata"in this.ia}};var ps=class{constructor(t){this.serializer=t}Ps(t){return Wt(this.serializer,t)}Is(t){return t.metadata.exists?ad(this.serializer,t.document,!1):yt.newNoDocument(this.Ps(t.metadata.name),this.Ts(t.metadata.readTime))}Ts(t){return ht(t)}},Ya=class{constructor(t,e,n){this.oa=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=kd(t)}_a(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ia.namedQuery)this.queries.push(t.ia.namedQuery);else if(t.ia.documentMetadata){this.documents.push({metadata:t.ia.documentMetadata}),t.ia.documentMetadata.exists||++e;let n=J.fromString(t.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.ia.document&&(this.documents[this.documents.length-1].document=t.ia.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}aa(t){let e=new Map,n=new ps(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Ps(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||K()).add(s);e.set(a,u)}}return e}complete(){return V(this,null,function*(){let t=yield Um(this.localStore,new ps(this.serializer),this.documents,this.oa.id),e=this.aa(this.documents);for(let n of this.queries)yield Bm(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:t}})}};function kd(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var ys=class{constructor(t){this.key=t}},_s=class{constructor(t){this.key=t}},ws=class{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=K(),this.mutatedKeys=K(),this.Ia=Uh(t),this.Ta=new ms(this.Ia)}get Ea(){return this.la}da(t,e){let n=e?e.Aa:new gs,i=e?e.Ta:this.Ta,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let w=i.get(f),b=ni(this.query,g)?g:null,N=!!w&&this.mutatedKeys.has(w.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),D=!1;w&&b?w.data.isEqual(b.data)?N!==k&&(n.track({type:3,doc:b}),D=!0):this.Ra(w,b)||(n.track({type:2,doc:b}),D=!0,(l&&this.Ia(b,l)>0||d&&this.Ia(b,d)<0)&&(u=!0)):!w&&b?(n.track({type:0,doc:b}),D=!0):w&&!b&&(n.track({type:1,doc:w}),D=!0,(l||d)&&(u=!0)),D&&(b?(a=a.add(b),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:a,Aa:n,Xi:u,mutatedKeys:s}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;let a=t.Aa.Q_();a.sort((f,g)=>function(b,N){let k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(b)-k(N)}(f.type,g.type)||this.Ia(f.doc,g.doc)),this.Va(n),i=i!=null&&i;let u=e&&!i?this.ma():[],l=this.Pa.size===0&&this.current&&!i?1:0,d=l!==this.ha;return this.ha=l,a.length!==0||d?{snapshot:new Bn(this.query,t.Ta,s,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}j_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new gs,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach(e=>this.la=this.la.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=t.current)}ma(){if(!this.current)return[];let t=this.Pa;this.Pa=K(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});let e=[];return t.forEach(n=>{this.Pa.has(n)||e.push(new _s(n))}),this.Pa.forEach(n=>{t.has(n)||e.push(new ys(n))}),e}pa(t){this.la=t.hs,this.Pa=K();let e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return Bn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},Za=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},tu=class{constructor(t){this.key=t,this.wa=!1}},eu=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new Zt(u=>Lh(u),ei),this.Da=new Map,this.Ca=new Set,this.va=new it(O.comparator),this.Fa=new Map,this.Ma=new jr,this.xa={},this.Oa=new Map,this.Na=On.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function eg(r,t,e=!0){return V(this,null,function*(){let n=Ds(r),i,s=n.ba.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Md(n,t,e,!0),i})}function ng(r,t){return V(this,null,function*(){let e=Ds(r);yield Md(e,t,!0,!1)})}function Md(r,t,e,n){return V(this,null,function*(){let i=yield Ln(r.localStore,kt(t)),s=i.targetId,a=e?r.sharedClientState.addLocalQueryTarget(s):"not-current",u;return n&&(u=yield Bu(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&xs(r.remoteStore,i),u})}function Bu(r,t,e,n,i){return V(this,null,function*(){r.Ba=(g,w,b)=>function(k,D,G,z){return V(this,null,function*(){let B=D.view.da(G);B.Xi&&(B=yield as(k.localStore,D.query,!1).then(({documents:v})=>D.view.da(v,B)));let W=z&&z.targetChanges.get(D.targetId),Z=z&&z.targetMismatches.get(D.targetId)!=null,Q=D.view.applyChanges(B,k.isPrimaryClient,W,Z);return nu(k,D.targetId,Q.fa),Q.snapshot})}(r,g,w,b);let s=yield as(r.localStore,t,!0),a=new ws(t,s.hs),u=a.da(s.documents),l=Ur.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,l);nu(r,e,d.fa);let f=new Za(t,e,a);return r.ba.set(t,f),r.Da.has(e)?r.Da.get(e).push(t):r.Da.set(e,[t]),d.snapshot})}function rg(r,t,e){return V(this,null,function*(){let n=F(r),i=n.ba.get(t),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(a=>!ei(a,t))),void n.ba.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield qn(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&Un(n.remoteStore,i.targetId),Gn(n,i.targetId)}).catch(ke))):(Gn(n,i.targetId),yield qn(n.localStore,i.targetId,!0))})}function ig(r,t){return V(this,null,function*(){let e=F(r),n=e.ba.get(t),i=e.Da.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Un(e.remoteStore,n.targetId))})}function sg(r,t,e){return V(this,null,function*(){let n=Ku(r);try{let i=yield function(a,u){let l=F(a),d=lt.now(),f=u.reduce((b,N)=>b.add(N.key),K()),g,w;return l.persistence.runTransaction("Locally write mutations","readwrite",b=>{let N=Mt(),k=K();return l.os.getEntries(b,f).next(D=>{N=D,N.forEach((G,z)=>{z.isValidDocument()||(k=k.add(G))})}).next(()=>l.localDocuments.getOverlayedDocuments(b,N)).next(D=>{g=D;let G=[];for(let z of u){let B=wm(z,g.get(z.key).overlayedDocument);B!=null&&G.push(new zt(z.key,B,xh(B.value.mapValue),ut.exists(!0)))}return l.mutationQueue.addMutationBatch(b,d,G,u)}).next(D=>{w=D;let G=D.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(b,D.batchId,G)})}).then(()=>({batchId:w.batchId,changes:Gh(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let d=a.xa[a.currentUser.toKey()];d||(d=new it(j)),d=d.insert(u,l),a.xa[a.currentUser.toKey()]=d}(n,i.batchId,e),yield he(n,i.changes),yield Hn(n.remoteStore)}catch(i){let s=Xn(i,"Failed to persist write");e.reject(s)}})}function Fd(r,t){return V(this,null,function*(){let e=F(r);try{let n=yield Lm(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Fa.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?q(a.wa):i.removedDocuments.size>0&&(q(a.wa),a.wa=!1))}),yield he(e,n,t)}catch(n){yield ke(n)}})}function ch(r,t,e){let n=F(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.ba.forEach((s,a)=>{let u=a.view.j_(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let l=F(a);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(let w of g.U_)w.j_(u)&&(d=!0)}),d&&Uu(l)}(n.eventManager,t),i.length&&n.Sa.h_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function og(r,t,e){return V(this,null,function*(){let n=F(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Fa.get(t),s=i&&i.key;if(s){let a=new it(O.comparator);a=a.insert(s,yt.newNoDocument(s,U.min()));let u=K().add(s),l=new qr(U.min(),new Map,new it(j),a,u);yield Fd(n,l),n.va=n.va.remove(s),n.Fa.delete(t),ju(n)}else yield qn(n.localStore,t,!1).then(()=>Gn(n,t,e)).catch(ke)})}function ag(r,t){return V(this,null,function*(){let e=F(r),n=t.batch.batchId;try{let i=yield Om(e.localStore,t);zu(e,n,null),Gu(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield he(e,i)}catch(i){yield ke(i)}})}function ug(r,t,e){return V(this,null,function*(){let n=F(r);try{let i=yield function(a,u){let l=F(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(q(g!==null),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(n.localStore,t);zu(n,t,e),Gu(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield he(n,i)}catch(i){yield ke(i)}})}function cg(r,t){return V(this,null,function*(){let e=F(r);Fe(e.remoteStore)||C("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(e.localStore);if(n===-1)return void t.resolve();let i=e.Oa.get(n)||[];i.push(t),e.Oa.set(n,i)}catch(n){let i=Xn(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function Gu(r,t){(r.Oa.get(t)||[]).forEach(e=>{e.resolve()}),r.Oa.delete(t)}function zu(r,t,e){let n=F(r),i=n.xa[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.xa[n.currentUser.toKey()]=i}}function Gn(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Da.get(t))r.ba.delete(n),e&&r.Sa.ka(n,e);r.Da.delete(t),r.isPrimaryClient&&r.Ma.Vr(t).forEach(n=>{r.Ma.containsKey(n)||Od(r,n)})}function Od(r,t){r.Ca.delete(t.path.canonicalString());let e=r.va.get(t);e!==null&&(Un(r.remoteStore,e),r.va=r.va.remove(t),r.Fa.delete(e),ju(r))}function nu(r,t,e){for(let n of e)n instanceof ys?(r.Ma.addReference(n.key,t),lg(r,n)):n instanceof _s?(C("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,t),r.Ma.containsKey(n.key)||Od(r,n.key)):L()}function lg(r,t){let e=t.key,n=e.path.canonicalString();r.va.get(e)||r.Ca.has(n)||(C("SyncEngine","New document in limbo: "+e),r.Ca.add(n),ju(r))}function ju(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){let t=r.Ca.values().next().value;r.Ca.delete(t);let e=new O(J.fromString(t)),n=r.Na.next();r.Fa.set(n,new tu(e)),r.va=r.va.insert(e,n),xs(r.remoteStore,new Fn(kt($n(e.path)),n,"TargetPurposeLimboResolution",Ot.oe))}}function he(r,t,e){return V(this,null,function*(){let n=F(r),i=[],s=[],a=[];n.ba.isEmpty()||(n.ba.forEach((u,l)=>{a.push(n.Ba(l,t,e).then(d=>{if((d||e)&&n.isPrimaryClient){let f=d&&!d.fromCache;n.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(d){i.push(d);let f=ka.Ki(l.targetId,d);s.push(f)}}))}),yield Promise.all(a),n.Sa.h_(i),yield function(l,d){return V(this,null,function*(){let f=F(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,w=>S.forEach(w.qi,b=>f.persistence.referenceDelegate.addReference(g,w.targetId,b)).next(()=>S.forEach(w.Qi,b=>f.persistence.referenceDelegate.removeReference(g,w.targetId,b)))))}catch(g){if(!Me(g))throw g;C("LocalStore","Failed to update sequence numbers: "+g)}for(let g of d){let w=g.targetId;if(!g.fromCache){let b=f.ns.get(w),N=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(N);f.ns=f.ns.insert(w,k)}}})}(n.localStore,s))})}function hg(r,t){return V(this,null,function*(){let e=F(r);if(!e.currentUser.isEqual(t)){C("SyncEngine","User change. New user:",t.toKey());let n=yield Td(e.localStore,t);e.currentUser=t,function(s,a){s.Oa.forEach(u=>{u.forEach(l=>{l.reject(new x(P.CANCELLED,a))})}),s.Oa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield he(e,n.us)}})}function dg(r,t){let e=F(r),n=e.Fa.get(t);if(n&&n.wa)return K().add(n.key);{let i=K(),s=e.Da.get(t);if(!s)return i;for(let a of s){let u=e.ba.get(a);i=i.unionWith(u.view.Ea)}return i}}function fg(r,t){return V(this,null,function*(){let e=F(r),n=yield as(e.localStore,t.query,!0),i=t.view.pa(n);return e.isPrimaryClient&&nu(e,t.targetId,i.fa),i})}function mg(r,t){return V(this,null,function*(){let e=F(r);return bd(e.localStore,t).then(n=>he(e,n))})}function gg(r,t,e,n){return V(this,null,function*(){let i=F(r),s=yield function(u,l){let d=F(u),f=F(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.vn(g,l).next(w=>w?d.localDocuments.getDocuments(g,w):S.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Hn(i.remoteStore):e==="acknowledged"||e==="rejected"?(zu(i,t,n||null),Gu(i,t),function(u,l){F(F(u).mutationQueue).Mn(l)}(i.localStore,t)):L(),yield he(i,s)):C("SyncEngine","Cannot apply mutation batch with id: "+t)})}function pg(r,t){return V(this,null,function*(){let e=F(r);if(Ds(e),Ku(e),t===!0&&e.La!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield lh(e,n.toArray());e.La=!0,yield Qa(e.remoteStore,!0);for(let s of i)xs(e.remoteStore,s)}else if(t===!1&&e.La!==!1){let n=[],i=Promise.resolve();e.Da.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Gn(e,a),qn(e.localStore,a,!0))),Un(e.remoteStore,a)}),yield i,yield lh(e,n),function(a){let u=F(a);u.Fa.forEach((l,d)=>{Un(u.remoteStore,d)}),u.Ma.mr(),u.Fa=new Map,u.va=new it(O.comparator)}(e),e.La=!1,yield Qa(e.remoteStore,!1)}})}function lh(r,t,e){return V(this,null,function*(){let n=F(r),i=[],s=[];for(let a of t){let u,l=n.Da.get(a);if(l&&l.length!==0){u=yield Ln(n.localStore,kt(l[0]));for(let d of l){let f=n.ba.get(d),g=yield fg(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=yield Sd(n.localStore,a);u=yield Ln(n.localStore,d),yield Bu(n,Ld(d),a,!1,u.resumeToken)}i.push(u)}return n.Sa.h_(s),i})}function Ld(r){return Oh(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function yg(r){return function(e){return F(F(e).persistence).Bi()}(F(r).localStore)}function _g(r,t,e,n){return V(this,null,function*(){let i=F(r);if(i.La)return void C("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield bd(i.localStore,qh(s[0])),u=qr.createSynthesizedRemoteEventForCurrentChange(t,e==="current",vt.EMPTY_BYTE_STRING);yield he(i,a,u);break}case"rejected":yield qn(i.localStore,t,!0),Gn(i,t,n);break;default:L()}})}function wg(r,t,e){return V(this,null,function*(){let n=Ds(r);if(n.La){for(let i of t){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){C("SyncEngine","Adding an already active target "+i);continue}let s=yield Sd(n.localStore,i),a=yield Ln(n.localStore,s);yield Bu(n,Ld(s),a.targetId,!1,a.resumeToken),xs(n.remoteStore,a)}for(let i of e)n.Da.has(i)&&(yield qn(n.localStore,i,!1).then(()=>{Un(n.remoteStore,i),Gn(n,i)}).catch(ke))}})}function Ds(r){let t=F(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Fd.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=dg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=og.bind(null,t),t.Sa.h_=Zm.bind(null,t.eventManager),t.Sa.ka=tg.bind(null,t.eventManager),t}function Ku(r){let t=F(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ag.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ug.bind(null,t),t}function vg(r,t,e){let n=F(r);(function(s,a,u){return V(this,null,function*(){try{let l=yield a.getMetadata();if(yield function(b,N){let k=F(b),D=ht(N.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",G=>k.$r.getBundleMetadata(G,N.id)).then(G=>!!G&&G.createTime.compareTo(D)>=0)}(s.localStore,l))return yield a.close(),u._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(l)),Promise.resolve(new Set);u._updateProgress(kd(l));let d=new Ya(l,s.localStore,a.serializer),f=yield a.qa();for(;f;){let w=yield d._a(f);w&&u._updateProgress(w),f=yield a.qa()}let g=yield d.complete();return yield he(s,g.ca,void 0),yield function(b,N){let k=F(b);return k.persistence.runTransaction("Save bundle","readwrite",D=>k.$r.saveBundleMetadata(D,N))}(s.localStore,l),u._completeWith(g.progress),Promise.resolve(g.ua)}catch(l){return Jt("SyncEngine",`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Wr=class{constructor(){this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){this.serializer=ri(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Id(this.persistence,new os,t.initialUser,this.serializer)}createPersistence(t){return new is(ss.Hr,this.serializer)}createSharedClientState(t){return new ls}terminate(){return V(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var vs=class r extends Wr{constructor(t,e,n){super(),this.Qa=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield lo(r.prototype,this,"initialize").call(this,t),yield this.Qa.initialize(this,t),yield Ku(this.Qa.syncEngine),yield Hn(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return Id(this.persistence,new os,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new wa(n,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let n=new Oo(e,this.persistence);return new Fo(t.asyncQueue,n)}createPersistence(t){let e=ku(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?qt.withCacheSize(this.cacheSizeBytes):qt.DEFAULT;return new Na(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Pd(),Di(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new ls}},ru=class r extends vs{constructor(t,e){super(t,e,!1),this.Qa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield lo(r.prototype,this,"initialize").call(this,t);let e=this.Qa.syncEngine;this.sharedClientState instanceof Vr&&(this.sharedClientState.syncEngine={Zs:gg.bind(null,e),Xs:_g.bind(null,e),eo:wg.bind(null,e),Bi:yg.bind(null,e),Ys:mg.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.fi(n=>V(this,null,function*(){yield pg(this.Qa.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=Pd();if(!Vr.D(e))throw new x(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ku(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Vr(e,t.asyncQueue,n,t.clientId,t.initialUser)}},Hr=class{initialize(t,e){return V(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>ch(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=hg.bind(null,this.syncEngine),yield Qa(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Ha}()}createDatastore(t){let e=ri(t.databaseInfo.databaseId),n=function(s){return new Ua(s)}(t.databaseInfo);return function(s,a,u,l){return new za(s,a,u,l)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(n,i,s,a,u){return new Ka(n,i,s,a,u)}(this.localStore,this.datastore,t.asyncQueue,e=>ch(this.syncEngine,e,0),function(){return hs.D()?new hs:new La}())}createSyncEngine(t,e){return function(i,s,a,u,l,d,f){let g=new eu(i,s,a,u,l,d);return f&&(g.La=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return V(this,null,function*(){var t;yield function(n){return V(this,null,function*(){let i=F(n);C("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield Wn(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function hh(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var zn=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):ct("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var iu=class{constructor(t,e){this.Ua=t,this.serializer=e,this.metadata=new pt,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}qa(){return V(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return V(this,null,function*(){let t=yield this.za();if(t===null)return null;let e=this.Wa.decode(t),n=Number(e);isNaN(n)&&this.ja(`length string (${e}) is not valid number`);let i=yield this.Ha(n);return new Xa(JSON.parse(i),t.length+n)})}Ja(){return this.buffer.findIndex(t=>t===123)}za(){return V(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let t=this.Ja();t<0&&this.ja("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Ha(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let e=this.Wa.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ja(t){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${t}`)}Ya(){return V(this,null,function*(){let t=yield this.Ua.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var su=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return V(this,null,function*(){let a=F(i),u={documents:s.map(g=>Br(a.serializer,g))},l=yield a.xo("BatchGetDocuments",a.serializer.databaseId,J.emptyPath(),u,s.length),d=new Map;l.forEach(g=>{let w=Sm(a.serializer,g);d.set(w.key.toString(),w)});let f=[];return s.forEach(g=>{let w=d.get(g.toString());q(!!w),f.push(w)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ve(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=O.fromPath(n);this.mutations.push(new Fr(i,this.precondition(i)))}),yield function(n,i){return V(this,null,function*(){let s=F(n),a={writes:i.map(u=>Gr(s.serializer,u))};yield s.Co("Commit",s.serializer.databaseId,J.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new x(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?ut.exists(!1):ut.updateTime(e):ut.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new x(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ut.updateTime(e)}return ut.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var ou=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new Qr(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>V(this,null,function*(){let t=new su(this.datastore),e=this.tu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.nu(i)}))}).catch(n=>{this.nu(n)})}))}tu(t){try{let e=this.updateFunction(t);return!Zr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}nu(t){this.Za>0&&this.ru(t)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(t)}ru(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Zh(e)}return!1}};var au=class{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=gt.UNAUTHENTICATED,this.clientId=Mi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,s=>V(this,null,function*(){C("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(C("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new pt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=Xn(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Ni(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),C("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>V(this,null,function*(){n.isEqual(i)||(yield Td(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function uu(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield Qu(r);C("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>ah(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>ah(t.remoteStore,i)),r._onlineComponents=t})}function qd(r){return r.name==="FirebaseError"?r.code===P.FAILED_PRECONDITION||r.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}function Qu(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){C("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ni(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!qd(e))throw e;Jt("Error using user provided cache. Falling back to memory cache: "+e),yield Ni(r,new Wr)}}else C("FirestoreClient","Using default OfflineComponentProvider"),yield Ni(r,new Wr);return r._offlineComponents})}function Ns(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(C("FirestoreClient","Using user provided OnlineComponentProvider"),yield uu(r,r._uninitializedComponentsProvider._online)):(C("FirestoreClient","Using default OnlineComponentProvider"),yield uu(r,new Hr))),r._onlineComponents})}function Ud(r){return Qu(r).then(t=>t.persistence)}function $u(r){return Qu(r).then(t=>t.localStore)}function Bd(r){return Ns(r).then(t=>t.remoteStore)}function Wu(r){return Ns(r).then(t=>t.syncEngine)}function Ig(r){return Ns(r).then(t=>t.datastore)}function jn(r){return V(this,null,function*(){let t=yield Ns(r),e=t.eventManager;return e.onListen=eg.bind(null,t.syncEngine),e.onUnlisten=rg.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=ng.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=ig.bind(null,t.syncEngine),e})}function Tg(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){let t=yield Ud(r),e=yield Bd(r);return t.setNetworkEnabled(!0),function(i){let s=F(i);return s.M_.delete(0),ii(s)}(e)}))}function Eg(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){let t=yield Ud(r),e=yield Bd(r);return t.setNetworkEnabled(!1),function(i){return V(this,null,function*(){let s=F(i);s.M_.add(0),yield Wn(s),s.N_.set("Offline")})}(e)}))}function Ag(r,t){let e=new pt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield function(d,f){let g=F(d);return g.persistence.runTransaction("read document","readonly",w=>g.localDocuments.getDocument(w,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new x(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=Xn(u,`Failed to get document '${s} from cache`);a.reject(l)}})}(yield $u(r),t,e)})),e.promise}function Gd(r,t,e={}){let n=new pt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(s,a,u,l,d){let f=new zn({next:w=>{a.enqueueAndForget(()=>qu(s,g));let b=w.docs.has(u);!b&&w.fromCache?d.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&w.fromCache&&l&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(w)},error:w=>d.reject(w)}),g=new $r($n(u.path),f,{includeMetadataChanges:!0,ra:!0});return Lu(s,g)}(yield jn(r),r.asyncQueue,t,e,n)})),n.promise}function Sg(r,t){let e=new pt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield as(i,s,!0),l=new ws(s,u.hs),d=l.da(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=Xn(u,`Failed to execute query '${s} against cache`);a.reject(l)}})}(yield $u(r),t,e)})),e.promise}function zd(r,t,e={}){let n=new pt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(s,a,u,l,d){let f=new zn({next:w=>{a.enqueueAndForget(()=>qu(s,g)),w.fromCache&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(w)},error:w=>d.reject(w)}),g=new $r(u,f,{includeMetadataChanges:!0,ra:!0});return Lu(s,g)}(yield jn(r),r.asyncQueue,t,e,n)})),n.promise}function bg(r,t){let e=new zn(t);return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s){F(i).z_.add(s),s.next()}(yield jn(r),e)})),()=>{e.$a(),r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s){F(i).z_.delete(s)}(yield jn(r),e)}))}}function Rg(r,t,e,n){let i=function(a,u){let l;return l=typeof a=="string"?ed().encode(a):a,function(f,g){return new iu(f,g)}(function(f,g){if(f instanceof Uint8Array)return hh(f,g);if(f instanceof ArrayBuffer)return hh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),u)}(e,ri(t));r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){vg(yield Wu(r),i,n)}))}function Pg(r,t){return r.asyncQueue.enqueue(()=>V(this,null,function*(){return function(n,i){let s=F(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.$r.getNamedQuery(a,i))}(yield $u(r),t)}))}function jd(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var dh=new Map;function Hu(r,t,e){if(!e)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Vg(r,t,e,n){if(t===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function fh(r){if(!O.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function mh(r){if(O.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ks(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L()}function Y(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=ks(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function Kd(r,t){if(t<=0)throw new x(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var Is=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Vg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jd((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},nn=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Is({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Is(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new bo;switch(n.type){case"firstParty":return new Co(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=dh.get(e);n&&(C("ComponentProvider","Removing Datastore"),dh.delete(e),n.terminate())}(this),Promise.resolve()}};function Cg(r,t,e,n={}){var i;let s=(r=Y(r,nn))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&Jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,l;if(typeof n.mockUserToken=="string")u=n.mockUserToken,l=gt.MOCK_USER;else{u=sl(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new gt(d)}r._authCredentials=new Ro(new ki(u,l))}}var Et=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},dt=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ht(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},Ht=class r extends Et{constructor(t,e,n){super(t,e,$n(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new dt(this.firestore,null,new O(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function ip(r,t,...e){if(r=_t(r),Hu("collection","path",t),r instanceof nn){let n=J.fromString(t,...e);return mh(n),new Ht(r,null,n)}{if(!(r instanceof dt||r instanceof Ht))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return mh(n),new Ht(r.firestore,null,n)}}function sp(r,t){if(r=Y(r,nn),Hu("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(r,null,function(n){return new Gt(J.emptyPath(),n)}(t))}function xg(r,t,...e){if(r=_t(r),arguments.length===1&&(t=Mi.newId()),Hu("doc","path",t),r instanceof nn){let n=J.fromString(t,...e);return fh(n),new dt(r,null,new O(n))}{if(!(r instanceof dt||r instanceof Ht))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return fh(n),new dt(r.firestore,r instanceof Ht?r.converter:null,new O(n))}}function op(r,t){return r=_t(r),t=_t(t),(r instanceof dt||r instanceof Ht)&&(t instanceof dt||t instanceof Ht)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function Dg(r,t){return r=_t(r),t=_t(t),r instanceof Et&&t instanceof Et&&r.firestore===t.firestore&&ei(r._query,t._query)&&r.converter===t.converter}var cu=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Qr(this,"async_queue_retry"),this.hu=()=>{let e=Di();e&&C("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};let t=Di();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;let e=Di();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise(()=>{});let e=new pt;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.su.push(t),this.Tu()))}Tu(){return V(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(t){if(!Me(t))throw t;C("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(t){let e=this.iu.then(()=>(this.uu=!0,t().catch(n=>{this.au=n,this.uu=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw ct("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.uu=!1,n))));return this.iu=e,e}enqueueAfterDelay(t,e,n){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);let i=$a.createAndSchedule(this,t,e,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&L()}verifyOperationInProgress(){}du(){return V(this,null,function*(){let t;do t=this.iu,yield t;while(t!==this.iu)})}Au(t){for(let e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then(()=>{this._u.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this._u)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.du()})}Vu(t){this.lu.push(t)}Eu(t){let e=this._u.indexOf(t);this._u.splice(e,1)}};function lu(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var hu=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new pt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var ap=-1,st=class extends nn{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=function(){return new cu}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Qd(this),this._firestoreClient.terminate()}};function up(r,t){let e=typeof r=="object"?r:fl(),n=typeof r=="string"?r:t||"(default)",i=hl(e,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=il("firestore");s&&Cg(i,...s)}return i}function At(r){return r._firestoreClient||Qd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Qd(r){var t,e,n;let i=r._freezeSettings(),s=function(u,l,d,f){return new Lo(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,jd(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._firestoreClient=new au(r._authCredentials,r._appCheckCredentials,r._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function cp(r,t){Wd(r=Y(r,st));let e=At(r);if(e._uninitializedComponentsProvider)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");Jt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=r._freezeSettings(),i=new Hr;return $d(e,i,new vs(i,n.cacheSizeBytes,t?.forceOwnership))}function lp(r){Wd(r=Y(r,st));let t=At(r);if(t._uninitializedComponentsProvider)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");Jt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings(),n=new Hr;return $d(t,n,new ru(n,e.cacheSizeBytes))}function $d(r,t,e){let n=new pt;return r.asyncQueue.enqueue(()=>V(this,null,function*(){try{yield Ni(r,e),yield uu(r,t),n.resolve()}catch(i){let s=i;if(!qd(s))throw s;Jt("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function hp(r){if(r._initialized&&!r._terminated)throw new x(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new pt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{yield function(n){return V(this,null,function*(){if(!Ee.D())return Promise.resolve();let i=n+"main";yield Ee.delete(i)})}(ku(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function dp(r){return function(e){let n=new pt;return e.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return cg(yield Wu(e),n)})),n.promise}(At(r=Y(r,st)))}function fp(r){return Tg(At(r=Y(r,st)))}function mp(r){return Eg(At(r=Y(r,st)))}function gp(r,t){let e=At(r=Y(r,st)),n=new hu;return Rg(e,r._databaseId,t,n),n}function pp(r,t){return Pg(At(r=Y(r,st)),t).then(e=>e?new Et(r,null,e.query):null)}function Wd(r){if(r._initialized||r._terminated)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Kn=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(vt.fromBase64String(t))}catch(e){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(vt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var xe=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var ce=class{constructor(t){this._methodName=t}};var Jr=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return j(this._lat,t._lat)||j(this._long,t._long)}};var Ng=/^__.*__$/,du=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new zt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Pe(t,this.data,e,this.fieldTransforms)}},Ts=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new zt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Hd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Es=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:n,yu:!1});return i.wu(t),i}Su(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return As(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(t.length===0)throw this.Du("Document fields must not be empty");if(Hd(this.fu)&&Ng.test(t))throw this.Du('Document fields cannot begin and end with "__"')}},fu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||ri(t)}Fu(t,e,n,i=!1){return new Es({fu:t,methodName:e,vu:n,path:wt.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function an(r){let t=r._freezeSettings(),e=ri(r._databaseId);return new fu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Ms(r,t,e,n,i,s={}){let a=r.Fu(s.merge||s.mergeFields?2:0,t,e,i);Yu("Data must be an object, but it was:",a,n);let u=Yd(n,a),l,d;if(s.merge)l=new Lt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let w=_u(t,g,e);if(!a.contains(w))throw new x(P.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);tf(f,w)||f.push(w)}l=new Lt(f),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new du(new Ct(u),l,d)}var Xr=class r extends ce{_toFieldTransform(t){if(t.fu!==2)throw t.fu===1?t.Du(`${this._methodName}() can only appear at the top level of your update data`):t.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Jd(r,t,e){return new Es({fu:3,vu:t.settings.vu,methodName:r._methodName,yu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var mu=class r extends ce{_toFieldTransform(t){return new Ze(t.path,new be)}isEqual(t){return t instanceof r}},gu=class r extends ce{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Jd(this,t,!0),n=this.Mu.map(s=>un(s,e)),i=new ae(n);return new Ze(t.path,i)}isEqual(t){return t instanceof r&&fo(this.Mu,t.Mu)}},pu=class r extends ce{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Jd(this,t,!0),n=this.Mu.map(s=>un(s,e)),i=new ue(n);return new Ze(t.path,i)}isEqual(t){return t instanceof r&&fo(this.Mu,t.Mu)}},yu=class r extends ce{constructor(t,e){super(t),this.xu=e}_toFieldTransform(t){let e=new Re(t.serializer,Qh(t.serializer,this.xu));return new Ze(t.path,e)}isEqual(t){return t instanceof r&&this.xu===t.xu}};function Ju(r,t,e,n){let i=r.Fu(1,t,e);Yu("Data must be an object, but it was:",i,n);let s=[],a=Ct.empty();on(n,(l,d)=>{let f=Zu(t,l,e);d=_t(d);let g=i.Su(f);if(d instanceof Xr)s.push(f);else{let w=un(d,g);w!=null&&(s.push(f),a.set(f,w))}});let u=new Lt(s);return new Ts(a,u,i.fieldTransforms)}function Xu(r,t,e,n,i,s){let a=r.Fu(1,t,e),u=[_u(t,n,e)],l=[i];if(s.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)u.push(_u(t,s[w])),l.push(s[w+1]);let d=[],f=Ct.empty();for(let w=u.length-1;w>=0;--w)if(!tf(d,u[w])){let b=u[w],N=l[w];N=_t(N);let k=a.Su(b);if(N instanceof Xr)d.push(b);else{let D=un(N,k);D!=null&&(d.push(b),f.set(b,D))}}let g=new Lt(d);return new Ts(f,g,a.fieldTransforms)}function Xd(r,t,e,n=!1){return un(e,r.Fu(n?4:3,t))}function un(r,t){if(Zd(r=_t(r)))return Yu("Unsupported field value:",t,r),Yd(r,t);if(r instanceof ce)return function(n,i){if(!Hd(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.yu&&t.fu!==4)throw t.Du("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let l=un(u,i.bu(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=_t(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Qh(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=lt.fromDate(n);return{timestampValue:Mn(i.serializer,s)}}if(n instanceof lt){let s=new lt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Mn(i.serializer,s)}}if(n instanceof Jr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Kn)return{bytesValue:nd(i.serializer,n._byteString)};if(n instanceof dt){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:xu(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${ks(n)}`)}(r,t)}function Yd(r,t){let e={};return Vh(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):on(r,(n,i)=>{let s=un(i,t.pu(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function Zd(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof lt||r instanceof Jr||r instanceof Kn||r instanceof dt||r instanceof ce)}function Yu(r,t,e){if(!Zd(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=ks(e);throw n==="an object"?t.Du(r+" a custom object"):t.Du(r+" "+n)}}function _u(r,t,e){if((t=_t(t))instanceof xe)return t._internalPath;if(typeof t=="string")return Zu(r,t);throw As("Field path arguments must be of type string or ",r,!1,void 0,e)}var kg=new RegExp("[~\\*/\\[\\]]");function Zu(r,t,e){if(t.search(kg)>=0)throw As(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new xe(...t.split("."))._internalPath}catch{throw As(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function As(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new x(P.INVALID_ARGUMENT,u+r+l)}function tf(r,t){return r.some(e=>e.isEqual(t))}var rn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new wu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Fs("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},wu=class extends rn{data(){return super.data()}};function Fs(r,t){return typeof t=="string"?Zu(r,t):t instanceof xe?t._internalPath:t._delegate._internalPath}function ef(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Yr=class{},sn=class extends Yr{};function yp(r,t,...e){let n=[];t instanceof Yr&&n.push(t),n=n.concat(e),function(s){let a=s.filter(l=>l instanceof vu).length,u=s.filter(l=>l instanceof Ss).length;if(a>1||a>0&&u>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var Ss=class r extends sn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return rf(t._query,e),new Et(t.firestore,t.converter,Xo(t._query,e))}_parse(t){let e=an(t.firestore);return function(s,a,u,l,d,f,g){let w;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ph(g,f);let b=[];for(let N of g)b.push(gh(l,s,N));w={arrayValue:{values:b}}}else w=gh(l,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ph(g,f),w=Xd(u,a,g,f==="in"||f==="not-in");return $.create(d,f,w)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function _p(r,t,e){let n=t,i=Fs("where",r);return Ss._create(i,n,e)}var vu=class r extends Yr{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)rf(a,l),a=Xo(a,l)}(t._query,e),new Et(t.firestore,t.converter,Xo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Iu=class r extends sn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xe(s,a)}(t._query,this._field,this._direction);return new Et(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new Gt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function wp(r,t="asc"){let e=t,n=Fs("orderBy",r);return Iu._create(n,e)}var bs=class r extends sn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new Et(t.firestore,t.converter,Ki(t._query,this._limit,this._limitType))}};function vp(r){return Kd("limit",r),bs._create("limit",r,"F")}function Ip(r){return Kd("limitToLast",r),bs._create("limitToLast",r,"L")}var Rs=class r extends sn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=nf(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new Gt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function Tp(...r){return Rs._create("startAt",r,!0)}function Ep(...r){return Rs._create("startAfter",r,!1)}var Ps=class r extends sn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=nf(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new Gt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function Ap(...r){return Ps._create("endBefore",r,!1)}function Sp(...r){return Ps._create("endAt",r,!0)}function nf(r,t,e,n){if(e[0]=_t(e[0]),e[0]instanceof rn)return function(s,a,u,l,d){if(!l)throw new x(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Sn(s))if(g.field.isKeyField())f.push(Je(a,l.key));else{let w=l.data.field(g.field);if(Cs(w))throw new x(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(w===null){let b=g.field.canonicalString();throw new x(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}f.push(w)}return new Yt(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=an(r.firestore);return function(a,u,l,d,f,g){let w=a.explicitOrderBy;if(f.length>w.length)throw new x(P.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let N=0;N<f.length;N++){let k=f[N];if(w[N].field.isKeyField()){if(typeof k!="string")throw new x(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!Vu(a)&&k.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let D=a.path.child(J.fromString(k));if(!O.isDocumentKey(D))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let G=new O(D);b.push(Je(u,G))}else{let D=Xd(l,d,k);b.push(D)}}return new Yt(b,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function gh(r,t,e){if(typeof(e=_t(e))=="string"){if(e==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vu(t)&&e.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(J.fromString(e));if(!O.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Je(r,new O(n))}if(e instanceof dt)return Je(r,e._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ks(e)}.`)}function ph(r,t){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function rf(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Vs=class{convertValue(t,e="none"){switch(He(t)){case 0:return null;case 1:return t.booleanValue;case 2:return at(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ae(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw L()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return on(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertGeoPoint(t){return new Jr(at(t.latitude),at(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Ru(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Nr(t));default:return null}}convertTimestamp(t){let e=oe(t);return new lt(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=J.fromString(t);q(fd(n));let i=new Cn(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(e)||ct(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Os(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var Tu=class extends Vs{constructor(t){super(),this.firestore=t}convertBytes(t){return new Kn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new dt(this.firestore,null,e)}};var se=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},De=class extends rn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Rn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Fs("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},Rn=class extends De{data(t={}){return super.data(t)}},Ne=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new se(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Rn(this._firestore,this._userDataWriter,n.key,n,new se(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new Rn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new Rn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Mg(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Mg(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function bp(r,t){return r instanceof De&&t instanceof De?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Ne&&t instanceof Ne&&r._firestore===t._firestore&&Dg(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function Rp(r){r=Y(r,dt);let t=Y(r.firestore,st);return Gd(At(t),r._key).then(e=>tc(t,r,e))}var le=class extends Vs{constructor(t){super(),this.firestore=t}convertBytes(t){return new Kn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new dt(this.firestore,null,e)}};function Pp(r){r=Y(r,dt);let t=Y(r.firestore,st),e=At(t),n=new le(t);return Ag(e,r._key).then(i=>new De(t,n,r._key,i,new se(i!==null&&i.hasLocalMutations,!0),r.converter))}function Vp(r){r=Y(r,dt);let t=Y(r.firestore,st);return Gd(At(t),r._key,{source:"server"}).then(e=>tc(t,r,e))}function Cp(r){r=Y(r,Et);let t=Y(r.firestore,st),e=At(t),n=new le(t);return ef(r._query),zd(e,r._query).then(i=>new Ne(t,n,r,i))}function xp(r){r=Y(r,Et);let t=Y(r.firestore,st),e=At(t),n=new le(t);return Sg(e,r._query).then(i=>new Ne(t,n,r,i))}function Dp(r){r=Y(r,Et);let t=Y(r.firestore,st),e=At(t),n=new le(t);return zd(e,r._query,{source:"server"}).then(i=>new Ne(t,n,r,i))}function Np(r,t,e){r=Y(r,dt);let n=Y(r.firestore,st),i=Os(r.converter,t,e);return Ls(n,[Ms(an(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,ut.none())])}function kp(r,t,e,...n){r=Y(r,dt);let i=Y(r.firestore,st),s=an(i),a;return a=typeof(t=_t(t))=="string"||t instanceof xe?Xu(s,"updateDoc",r._key,t,e,n):Ju(s,"updateDoc",r._key,t),Ls(i,[a.toMutation(r._key,ut.exists(!0))])}function Mp(r){return Ls(Y(r.firestore,st),[new Ve(r._key,ut.none())])}function Fp(r,t){let e=Y(r.firestore,st),n=xg(r),i=Os(r.converter,t);return Ls(e,[Ms(an(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ut.exists(!1))]).then(()=>n)}function Op(r,...t){var e,n,i;r=_t(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||lu(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(lu(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,d,f;if(r instanceof dt)d=Y(r.firestore,st),f=$n(r._key.path),l={next:g=>{t[a]&&t[a](tc(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=Y(r,Et);d=Y(g.firestore,st),f=g._query;let w=new le(d);l={next:b=>{t[a]&&t[a](new Ne(d,w,g,b))},error:t[a+1],complete:t[a+2]},ef(r._query)}return function(w,b,N,k){let D=new zn(k),G=new $r(b,D,N);return w.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Lu(yield jn(w),G)})),()=>{D.$a(),w.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return qu(yield jn(w),G)}))}}(At(d),f,u,l)}function Lp(r,t){return bg(At(r=Y(r,st)),lu(t)?t:{next:t})}function Ls(r,t){return function(n,i){let s=new pt;return n.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return sg(yield Wu(n),i,s)})),s.promise}(At(r),t)}function tc(r,t,e){let n=e.docs.get(t._key),i=new le(r);return new De(r,i,t._key,n,new se(e.hasPendingWrites,e.fromCache),t.converter)}var Fg={maxAttempts:5};var yh=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=an(t)}set(t,e,n){this._verifyNotCommitted();let i=ve(t,this._firestore),s=Os(i.converter,e,n),a=Ms(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ut.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=ve(t,this._firestore),a;return a=typeof(e=_t(e))=="string"||e instanceof xe?Xu(this._dataReader,"WriteBatch.update",s._key,e,n,i):Ju(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,ut.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=ve(t,this._firestore);return this._mutations=this._mutations.concat(new Ve(e._key,ut.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ve(r,t){if((r=_t(r)).firestore!==t)throw new x(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var Eu=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=an(e)}get(e){let n=ve(e,this._firestore),i=new Tu(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return L();let a=s[0];if(a.isFoundDocument())return new rn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new rn(this._firestore,i,n._key,null,n.converter);throw L()})}set(e,n,i){let s=ve(e,this._firestore),a=Os(s.converter,n,i),u=Ms(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=ve(e,this._firestore),u;return u=typeof(n=_t(n))=="string"||n instanceof xe?Xu(this._dataReader,"Transaction.update",a._key,n,i,s):Ju(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=ve(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=ve(t,this._firestore),n=new le(this._firestore);return super.get(t).then(i=>new De(this._firestore,n,e._key,i._document,new se(!1,!1),e.converter))}};function Up(r,t,e){r=Y(r,st);let n=Object.assign(Object.assign({},Fg),e);return function(s){if(s.maxAttempts<1)throw new x(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let l=new pt;return s.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){let d=yield Ig(s);new ou(s.asyncQueue,d,u,a,l).Xa()})),l.promise}(At(r),i=>t(new Eu(r,i)),n)}function Bp(){return new Xr("deleteField")}function Gp(){return new mu("serverTimestamp")}function zp(...r){return new gu("arrayUnion",r)}function jp(...r){return new pu("arrayRemove",r)}function Kp(r){return new yu("increment",r)}(function(t,e=!0){(function(i){Qn=i})(dl),ll(new ul("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new st(new Po(n.getProvider("auth-internal")),new Do(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cn(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),mo(yl,"4.6.3",t),mo(yl,"4.6.3","esm2017")})();export{Yg as a,Jt as b,Zg as c,x as d,lt as e,wt as f,O as g,ep as h,Cn as i,Vg as j,Y as k,Cg as l,dt as m,ip as n,sp as o,xg as p,op as q,Dg as r,ap as s,up as t,At as u,cp as v,lp as w,hp as x,dp as y,fp as z,mp as A,gp as B,pp as C,Kn as D,xe as E,Jr as F,yp as G,_p as H,wp as I,vp as J,Ip as K,Tp as L,Ep as M,Ap as N,Sp as O,Vs as P,De as Q,Rn as R,Ne as S,bp as T,Rp as U,Pp as V,Vp as W,Cp as X,xp as Y,Dp as Z,Np as _,kp as $,Mp as aa,Fp as ba,Op as ca,Lp as da,Ls as ea,yh as fa,Up as ga,Bp as ha,Gp as ia,zp as ja,jp as ka,Kp as la,qg as ma};
